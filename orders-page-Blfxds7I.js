import{j as e,aE as c,aF as T,aG as K,aH as u,aI as R,aJ as A,aK as b,k as E,r as x,m as _,aL as J,M as U,o as Y,a3 as G,a4 as W,at as X,p as Z,B as h,a9 as ee,I as se,H as C,J as S,N as P,O as r,g as ae,aM as M,aN as le,aO as te,aP as re,aQ as ne,b as D,C as F}from"./index-DE3WvtMD.js";import{S as ie}from"./shopping-bag-D9-csZ7J.js";import{F as ce}from"./filter-BKVlahs0.js";function de({columns:l=5,rows:m=8,showSearch:g=!1,showPagination:j=!1}){return e.jsxs("div",{className:"space-y-4",children:[g&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{className:"h-10 flex-1 max-w-sm"}),e.jsx(c,{className:"h-10 w-32"})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(T,{children:[e.jsx(K,{children:e.jsx(u,{children:Array.from({length:l}).map((y,d)=>e.jsx(R,{children:e.jsx(c,{className:"h-4 w-20"})},d))})}),e.jsx(A,{children:Array.from({length:m}).map((y,d)=>e.jsx(u,{children:Array.from({length:l}).map((N,o)=>e.jsx(b,{children:e.jsx(c,{className:`h-4 ${o===0?"w-16":o===1?"w-32":"w-24"}`})},o))},d))})]})}),j&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{className:"h-4 w-32"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(c,{className:"h-8 w-20"}),e.jsx(c,{className:"h-8 w-20"})]})]})]})}function me(){var w,v;const{user:l}=E(),[m,g]=x.useState([]),[j,y]=x.useState([]),[d,N]=x.useState("all"),[o,I]=x.useState("all"),i=(l==null?void 0:l.role)||"buyer",{data:p,isLoading:k}=_({queryKey:["/api/orders"],enabled:!!l,staleTime:60*1e3}),O=[{accessorKey:"id",header:"Order ID",cell:({row:s})=>e.jsxs("span",{className:"font-medium",children:["#",s.original.id]})},{accessorKey:"listing.title",header:"Product",cell:({row:s})=>{var a;return((a=s.original.listing)==null?void 0:a.title)||`Product #${s.original.listingId}`}},{accessorKey:"seller.username",header:"Seller",cell:({row:s})=>{var a;return((a=s.original.seller)==null?void 0:a.username)||`Seller #${s.original.sellerId}`}},{accessorKey:"quantity",header:"Quantity"},{accessorKey:"totalPrice",header:"Total",cell:({row:s})=>e.jsxs("span",{className:"font-medium",children:["$",s.original.totalPrice.toFixed(2)]})},{accessorKey:"status",header:"Status",cell:({row:s})=>{const a=s.original.status,n={pending:"bg-yellow-100 text-yellow-800",processing:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"}[a];return e.jsx(D,{className:`${n} border-0`,children:a.charAt(0).toUpperCase()+a.slice(1)})}},{accessorKey:"createdAt",header:"Date",cell:({row:s})=>new Date(s.original.createdAt).toLocaleDateString()},{id:"actions",cell:({row:s})=>e.jsx(h,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",asChild:!0,children:e.jsx("a",{href:`/orders/${s.original.id}`,children:e.jsx(F,{className:"h-4 w-4"})})})}],$=[{accessorKey:"id",header:"Order ID",cell:({row:s})=>e.jsxs("span",{className:"font-medium",children:["#",s.original.id]})},{accessorKey:"listing.title",header:"Product",cell:({row:s})=>{var a;return((a=s.original.listing)==null?void 0:a.title)||`Product #${s.original.listingId}`}},{accessorKey:"buyer.username",header:"Buyer",cell:({row:s})=>{var a;return((a=s.original.buyer)==null?void 0:a.username)||`Buyer #${s.original.buyerId}`}},{accessorKey:"quantity",header:"Quantity"},{accessorKey:"totalPrice",header:"Total",cell:({row:s})=>e.jsxs("span",{className:"font-medium",children:["$",s.original.totalPrice.toFixed(2)]})},{accessorKey:"status",header:"Status",cell:({row:s})=>{const a=s.original.status,n={pending:"bg-yellow-100 text-yellow-800",processing:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"}[a];return e.jsx(D,{className:`${n} border-0`,children:a.charAt(0).toUpperCase()+a.slice(1)})}},{accessorKey:"createdAt",header:"Date",cell:({row:s})=>new Date(s.original.createdAt).toLocaleDateString()},{id:"actions",cell:({row:s})=>e.jsx(h,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",asChild:!0,children:e.jsx("a",{href:`/orders/${s.original.id}`,children:e.jsx(F,{className:"h-4 w-4"})})})}],B=(s,a)=>s?a==="all"?s:s.filter(n=>n.status===a):[],L=(s,a)=>{if(!s)return[];if(a==="all")return s;const n=new Date,V={today:1,week:7,month:30,quarter:90}[a]||0,z=new Date(n.setDate(n.getDate()-V));return s.filter(Q=>new Date(Q.createdAt)>=z)},f=p?i==="buyer"?p.filter(s=>s.buyerId===(l==null?void 0:l.id)):p.filter(s=>s.sellerId===(l==null?void 0:l.id)):[],H=B(f,d),q=L(H,o),t=J({data:q,columns:i==="buyer"?O:$,getCoreRowModel:le(),getPaginationRowModel:te(),onSortingChange:g,getSortedRowModel:re(),onColumnFiltersChange:y,getFilteredRowModel:ne(),state:{sorting:m,columnFilters:j}});return e.jsxs(U,{children:[e.jsx("div",{className:"mb-6 flex flex-col md:flex-row md:items-center md:justify-between",children:e.jsx("h1",{className:"text-2xl font-bold text-neutral-800 mb-2 md:mb-0",children:"Order Management"})}),e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsx(W,{children:i==="buyer"?"My Purchases":"Customer Orders"}),e.jsx(X,{children:i==="buyer"?"Track your purchases and order history":"Manage and fulfill customer orders"})]}),e.jsx(Z,{children:k?e.jsx(de,{columns:i==="buyer"?6:5,rows:10,showSearch:!0,showPagination:!0}):f.length===0?e.jsxs("div",{className:"text-center p-8",children:[e.jsx(ie,{className:"h-12 w-12 text-neutral-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No orders yet"}),e.jsx("p",{className:"text-neutral-600 mb-4",children:i==="buyer"?"You haven't placed any orders yet.":"You haven't received any orders yet."}),i==="buyer"&&e.jsx(h,{onClick:()=>window.location.href="/listings",children:"Browse Listings"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-neutral-500"}),e.jsx(se,{placeholder:"Search by ID or product...",value:((w=t.getColumn("listing.title"))==null?void 0:w.getFilterValue())??"",onChange:s=>{var a;return(a=t.getColumn("listing.title"))==null?void 0:a.setFilterValue(s.target.value)},className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-40",children:e.jsxs(C,{value:d,onValueChange:N,children:[e.jsx(S,{className:"h-full",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Status"})]})}),e.jsxs(P,{children:[e.jsx(r,{value:"all",children:"All Statuses"}),e.jsx(r,{value:"pending",children:"Pending"}),e.jsx(r,{value:"processing",children:"Processing"}),e.jsx(r,{value:"completed",children:"Completed"}),e.jsx(r,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx("div",{className:"w-40",children:e.jsxs(C,{value:o,onValueChange:I,children:[e.jsx(S,{className:"h-full",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Time Period"})]})}),e.jsxs(P,{children:[e.jsx(r,{value:"all",children:"All Time"}),e.jsx(r,{value:"today",children:"Today"}),e.jsx(r,{value:"week",children:"This Week"}),e.jsx(r,{value:"month",children:"This Month"}),e.jsx(r,{value:"quarter",children:"Last 3 Months"})]})]})})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(T,{children:[e.jsx(K,{children:t.getHeaderGroups().map(s=>e.jsx(u,{children:s.headers.map(a=>e.jsx(R,{children:a.isPlaceholder?null:M(a.column.columnDef.header,a.getContext())},a.id))},s.id))}),e.jsx(A,{children:(v=t.getRowModel().rows)!=null&&v.length?t.getRowModel().rows.map(s=>e.jsx(u,{"data-state":s.getIsSelected()&&"selected",className:"cursor-pointer hover:bg-neutral-50",onClick:()=>window.location.href=`/orders/${s.original.id}`,children:s.getVisibleCells().map(a=>e.jsx(b,{children:M(a.column.columnDef.cell,a.getContext())},a.id))},s.id)):e.jsx(u,{children:e.jsx(b,{colSpan:t.getAllColumns().length,className:"h-24 text-center",children:"No results."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsxs("div",{className:"flex-1 text-sm text-muted-foreground",children:["Showing ",t.getRowModel().rows.length," of"," ",f.length," orders"]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>t.previousPage(),disabled:!t.getCanPreviousPage(),children:"Previous"}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>t.nextPage(),disabled:!t.getCanNextPage(),children:"Next"})]})]})]})})]})]})}export{me as default};

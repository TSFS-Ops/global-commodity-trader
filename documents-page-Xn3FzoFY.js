import{c as re,j as e,R as Ee,b9 as Be,r as m,ba as Dt,bb as St,V as $e,bc as Ct,bd as zt,Y as Tt,be as Mt,bf as At,bg as _e,bh as Ft,bi as Pt,a as E,bj as Ie,bk as Rt,ah as kt,bl as R,B as I,L as he,b as k,aa as Et,aj as Bt,a2 as X,k as $t,l as _t,m as It,ak as Ot,n as be,M as Ne,ad as Ut,am as Lt,an as de,ao as me,as as ue,H as De,aq as pe,J as Se,K as Ce,N as ze,O as T,ar as ge,I as Vt,aD as Kt,o as q,a3 as Y,a4 as H,p as J,b0 as Oe,au as Gt,aw as se,al as Wt,F as Te,G as Me}from"./index-DE3WvtMD.js";import{T as qt}from"./textarea-DxM8kpuO.js";import{D as Yt,b as Ht,a as Jt,c as Xt,d as Qt,e as Zt,f as es}from"./dialog-BEaSUMTJ.js";import{U as Ue}from"./upload-YqRjUqR5.js";import{C as Ae}from"./calendar-DiUGKtnE.js";import{F as ts}from"./filter-BKVlahs0.js";import{D as ss}from"./download-CIyHHug6.js";import{F as as}from"./file-check-D0L7z-oh.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=re("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=re("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=re("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=re("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);var ns=Symbol("radix.slottable");function ls(t){const s=({children:a})=>e.jsx(e.Fragment,{children:a});return s.displayName=`${t}.Slottable`,s.__radixId=ns,s}var Le="AlertDialog",[cs,Qs]=Ee(Le,[Be]),B=Be(),Ve=t=>{const{__scopeAlertDialog:s,...a}=t,i=B(s);return e.jsx(Ft,{...i,...a,modal:!0})};Ve.displayName=Le;var ds="AlertDialogTrigger",Ke=m.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...i}=t,n=B(a);return e.jsx(Dt,{...n,...i,ref:s})});Ke.displayName=ds;var ms="AlertDialogPortal",Ge=t=>{const{__scopeAlertDialog:s,...a}=t,i=B(s);return e.jsx(Pt,{...i,...a})};Ge.displayName=ms;var us="AlertDialogOverlay",We=m.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...i}=t,n=B(a);return e.jsx(St,{...n,...i,ref:s})});We.displayName=us;var U="AlertDialogContent",[ps,gs]=cs(U),hs=ls("AlertDialogContent"),qe=m.forwardRef((t,s)=>{const{__scopeAlertDialog:a,children:i,...n}=t,l=B(a),f=m.useRef(null),o=$e(s,f),h=m.useRef(null);return e.jsx(Ct,{contentName:U,titleName:Ye,docsSlug:"alert-dialog",children:e.jsx(ps,{scope:a,cancelRef:h,children:e.jsxs(zt,{role:"alertdialog",...l,...n,ref:o,onOpenAutoFocus:Tt(n.onOpenAutoFocus,c=>{var j;c.preventDefault(),(j=h.current)==null||j.focus({preventScroll:!0})}),onPointerDownOutside:c=>c.preventDefault(),onInteractOutside:c=>c.preventDefault(),children:[e.jsx(hs,{children:i}),e.jsx(xs,{contentRef:f})]})})})});qe.displayName=U;var Ye="AlertDialogTitle",He=m.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...i}=t,n=B(a);return e.jsx(Mt,{...n,...i,ref:s})});He.displayName=Ye;var Je="AlertDialogDescription",Xe=m.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...i}=t,n=B(a);return e.jsx(At,{...n,...i,ref:s})});Xe.displayName=Je;var fs="AlertDialogAction",Qe=m.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...i}=t,n=B(a);return e.jsx(_e,{...n,...i,ref:s})});Qe.displayName=fs;var Ze="AlertDialogCancel",et=m.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...i}=t,{cancelRef:n}=gs(Ze,a),l=B(a),f=$e(s,n);return e.jsx(_e,{...l,...i,ref:f})});et.displayName=Ze;var xs=({contentRef:t})=>{const s=`\`${U}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${U}\` by passing a \`${Je}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${U}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return m.useEffect(()=>{var i;document.getElementById((i=t.current)==null?void 0:i.getAttribute("aria-describedby"))||console.warn(s)},[s,t]),null},ys=Ve,vs=Ke,js=Ge,tt=We,st=qe,at=Qe,it=et,rt=He,ot=Xe;const ws=ys,bs=vs,Ns=js,nt=m.forwardRef(({className:t,...s},a)=>e.jsx(tt,{className:E("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:a}));nt.displayName=tt.displayName;const lt=m.forwardRef(({className:t,...s},a)=>e.jsxs(Ns,{children:[e.jsx(nt,{}),e.jsx(st,{ref:a,className:E("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s})]}));lt.displayName=st.displayName;const ct=({className:t,...s})=>e.jsx("div",{className:E("flex flex-col space-y-2 text-center sm:text-left",t),...s});ct.displayName="AlertDialogHeader";const dt=({className:t,...s})=>e.jsx("div",{className:E("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});dt.displayName="AlertDialogFooter";const mt=m.forwardRef(({className:t,...s},a)=>e.jsx(rt,{ref:a,className:E("text-lg font-semibold",t),...s}));mt.displayName=rt.displayName;const ut=m.forwardRef(({className:t,...s},a)=>e.jsx(ot,{ref:a,className:E("text-sm text-muted-foreground",t),...s}));ut.displayName=ot.displayName;const pt=m.forwardRef(({className:t,...s},a)=>e.jsx(at,{ref:a,className:E(Ie(),t),...s}));pt.displayName=at.displayName;const gt=m.forwardRef(({className:t,...s},a)=>e.jsx(it,{ref:a,className:E(Ie({variant:"outline"}),"mt-2 sm:mt-0",t),...s}));gt.displayName=it.displayName;var Ds=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ht=Ds.reduce((t,s)=>{const a=Rt(`Primitive.${s}`),i=m.forwardRef((n,l)=>{const{asChild:f,...o}=n,h=f?a:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(h,{...o,ref:l})});return i.displayName=`Primitive.${s}`,{...t,[s]:i}},{}),xe="Progress",ye=100,[Ss,Zs]=Ee(xe),[Cs,zs]=Ss(xe),ft=m.forwardRef((t,s)=>{const{__scopeProgress:a,value:i=null,max:n,getValueLabel:l=Ts,...f}=t;(n||n===0)&&!Pe(n)&&console.error(Ms(`${n}`,"Progress"));const o=Pe(n)?n:ye;i!==null&&!Re(i,o)&&console.error(As(`${i}`,"Progress"));const h=Re(i,o)?i:null,c=ie(h)?l(h,o):void 0;return e.jsx(Cs,{scope:a,value:h,max:o,children:e.jsx(ht.div,{"aria-valuemax":o,"aria-valuemin":0,"aria-valuenow":ie(h)?h:void 0,"aria-valuetext":c,role:"progressbar","data-state":vt(h,o),"data-value":h??void 0,"data-max":o,...f,ref:s})})});ft.displayName=xe;var xt="ProgressIndicator",yt=m.forwardRef((t,s)=>{const{__scopeProgress:a,...i}=t,n=zs(xt,a);return e.jsx(ht.div,{"data-state":vt(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...i,ref:s})});yt.displayName=xt;function Ts(t,s){return`${Math.round(t/s*100)}%`}function vt(t,s){return t==null?"indeterminate":t===s?"complete":"loading"}function ie(t){return typeof t=="number"}function Pe(t){return ie(t)&&!isNaN(t)&&t>0}function Re(t,s){return ie(t)&&!isNaN(t)&&t<=s&&t>=0}function Ms(t,s){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${s}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${ye}\`.`}function As(t,s){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${s}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${ye} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var jt=ft,Fs=yt;const fe=m.forwardRef(({className:t,value:s,...a},i)=>e.jsx(jt,{ref:i,className:E("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...a,children:e.jsx(Fs,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));fe.displayName=jt.displayName;const Ps={maxWidth:1600,maxHeight:1600,quality:.78,maxSizeMB:1.2,stripEXIF:!0,convertFormat:!0};function ae(t){return["image/jpeg","image/jpg","image/png","image/webp","image/heic","image/heif"].includes(t.type.toLowerCase())}function Rs(t){return new Promise((s,a)=>{const i=new FileReader;i.onload=()=>s(i.result),i.onerror=()=>a(new Error("Failed to read file")),i.readAsArrayBuffer(t)})}async function ks(t,s={},a,i=0){const n={...Ps,...s},l=t.size;try{return ae(t)?await Es(t,n,a,i):{file:t,originalSize:l,compressedSize:l,compressionRatio:1,success:!0,fileIndex:i}}catch(f){return a==null||a({stage:"error",progress:0,message:"Compression failed"}),console.warn("Image compression failed:",f),{file:t,originalSize:l,compressedSize:l,compressionRatio:1,success:!1,error:f instanceof Error?f.message:"Unknown error",fileIndex:i}}}async function Es(t,s,a,i=0){return new Promise((n,l)=>{const f=new Worker(new URL("/assets/compressionWorker-DemDxX0M.js",import.meta.url),{type:"module"}),o=()=>{f.terminate()};f.onmessage=h=>{const c=h.data;if(c.type==="progress")a==null||a(c.progress);else if(c.type==="result")if(o(),c.success&&c.compressedBuffer){const j=new File([c.compressedBuffer],t.name,{type:c.compressedType,lastModified:Date.now()});n({file:j,originalSize:c.originalSize,compressedSize:c.compressedSize,compressionRatio:c.compressionRatio,success:!0,fileIndex:i})}else n({file:t,originalSize:t.size,compressedSize:t.size,compressionRatio:1,success:!1,error:"Compression failed",fileIndex:i});else if(c.type==="error"){o();const j=c.error&&c.error.includes("Unable to compress")&&c.error.includes("below");n({file:t,originalSize:t.size,compressedSize:t.size,compressionRatio:1,success:!1,error:c.error,blocked:j,fileIndex:i})}},f.onerror=h=>{o(),l(new Error(`Worker error: ${h.message}`))},Rs(t).then(h=>{f.postMessage({type:"compress",fileBuffer:h,fileName:t.name,fileType:t.type,options:s,fileIndex:i})}).catch(h=>{o(),l(h)})})}async function Bs(t,s={},a){const n=new Array(t.length);for(let l=0;l<t.length;l+=3){const o=t.slice(l,l+3).map((c,j)=>{const F=l+j;return ks(c,s,L=>a==null?void 0:a(F,L),F)});(await Promise.all(o)).forEach((c,j)=>{const F=l+j;n[F]=c})}return n}const $s=(t,s)=>{var i;const a=((i=s.split("/")[1])==null?void 0:i.toUpperCase())||"this file type";switch(t){case"listing-images":case"profile-images":return`We can't use ${a} files for photos. Please choose a JPEG, PNG, WebP, GIF, HEIC, or HEIF image instead. Most cameras and phones save photos in these formats.`;case"compliance-docs":return`${a} isn't supported for business documents. Please upload your document as a PDF, Word file, or high-quality JPEG/PNG scan instead.`;case"chat-attachments":return`${a} files can't be shared in chat. Try a photo (JPEG, PNG, WebP, GIF) or document (PDF, Word, text file) instead.`;case"general":default:return`${a} files aren't supported here. Please choose a PDF, Word document, text file, JPEG, or PNG instead.`}},_s=(t,s)=>{if(s)return"We'll optimize your photo";switch(t){case"compliance-docs":return"Document needs to be smaller";case"listing-images":case"profile-images":return"Photo needs to be smaller";case"chat-attachments":return"File is too big for chat";default:return"File is too big"}},Is=(t,s,a,i)=>{const n=Math.round(a/1024/1024),l=(s.size/1024/1024).toFixed(1);switch(t){case"listing-images":case"profile-images":return i?`No worries! Your ${l}MB photo will be automatically compressed for faster loading while keeping it looking great. This usually reduces size by 70-80%.`:`Your photo is ${l}MB, but we need it under 1.2MB for fast loading. Try taking a new photo at a lower resolution, or use an image editing app to reduce the file size.`;case"compliance-docs":return`Your document is ${l}MB, but compliance documents need to be under ${n}MB for easier processing. Try saving your PDF at a lower quality, or split large documents into separate files.`;case"chat-attachments":return i?`Your ${l}MB photo will be optimized for chat sharing (max 1MB). Documents need to stay under 5MB.`:`This ${l}MB file is too big for chat. Photos are automatically compressed to 1MB, but documents need to be under 5MB. Try a smaller file or compress it first.`;case"general":default:return`${s.name} is ${l}MB, but we can only accept files up to ${n}MB. Try compressing the file or choosing a smaller version.`}},Os=(t,s)=>{switch(t){case"listing-images":return{title:"Choose your best photos",description:`You can upload up to ${s} photos for your listing. Quality over quantity works best - pick the images that really showcase your product!`};case"profile-images":return{title:"Just one profile photo",description:"Choose your best photo to represent you. You can always change it later in your profile settings."};case"compliance-docs":return{title:"Document upload limit",description:`You can upload up to ${s} compliance documents. If you need to add more, remove some existing ones first, or combine related documents into a single PDF.`};case"chat-attachments":return{title:"Too many files for one message",description:`You can attach up to ${s} files per message. Send this message first, then start a new one for additional files.`};case"general":default:return{title:"File upload limit",description:`You can upload up to ${s} files at once. Try uploading in smaller batches if you need to add more.`}}},_=(t,s={})=>{try{fetch("/api/telemetry/event",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventType:t,metadata:{timestamp:new Date().toISOString(),...s}})}).catch(()=>{})}catch{}};function Us({maxNumberOfFiles:t=5,maxFileSize:s=10485760,acceptedFileTypes:a,onFilesUploaded:i,buttonClassName:n,children:l,uploadType:f="document",uploadContext:o="general"}){const[h,c]=m.useState(!1),[j,F]=m.useState(!1),[L,Q]=m.useState({}),[Z,V]=m.useState(0),[D,O]=m.useState([]),[ee,oe]=m.useState([]),[r,d]=m.useState(new Map),w=kt("enableClientCompression"),{logShadowEvent:$}=Bt(),v=(()=>{switch(o){case"listing-images":return{maxFileSize:15*1024*1024,maxNumberOfFiles:5,allowedTypes:["image/jpeg","image/png","image/gif","image/webp","image/heic","image/heif"],compressImages:!0,targetSizeMB:1.2};case"profile-images":return{maxFileSize:15*1024*1024,maxNumberOfFiles:1,allowedTypes:["image/jpeg","image/png","image/gif","image/webp","image/heic","image/heif"],compressImages:!0,targetSizeMB:1.2};case"compliance-docs":return{maxFileSize:10*1024*1024,maxNumberOfFiles:5,allowedTypes:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png"],compressImages:!1,targetSizeMB:null};case"chat-attachments":return{maxFileSize:5*1024*1024,maxNumberOfFiles:3,allowedTypes:["image/jpeg","image/png","image/gif","image/webp","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"],compressImages:!0,targetSizeMB:1};case"general":default:return{maxFileSize:5*1024*1024,maxNumberOfFiles:5,allowedTypes:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain","image/jpeg","image/png"],compressImages:!1,targetSizeMB:null}}})(),ve=s!==void 0?s:v.maxFileSize,le=t!==void 0?t:v.maxNumberOfFiles,te=a||v.allowedTypes,wt=m.useCallback(async u=>{if(!u)return;const N=Array.from(u),y=[],M=[];for(const p of N){if(!te.includes(p.type)){const G=$s(o,p.type);R({title:"Can't use this file type",description:G,variant:"destructive"}),_("upload_blocked_mime_type",{fileName:p.name,fileType:p.type,uploadContext:o,allowedTypes:te.join(", ")});continue}const A=v.compressImages&&ae(p),S=A&&w,P=ve;if(A&&$("enableClientCompression",S?"compression_enabled":"compression_disabled",{uploadContext:o,fileName:p.name,fileType:p.type,fileSizeMB:(p.size/1024/1024).toFixed(2),flagEnabled:w,contextConfig:v.compressImages}),p.size>P){const G=Is(o,p,P,S);R({title:_s(o,S),description:G,variant:"destructive"}),S?_("upload_image_blocked_size",{fileName:p.name,fileType:p.type,uploadContext:o,originalSizeKB:Math.round(p.size/1024),targetSizeMB:v.targetSizeMB||1.2,postCompression:!1,compressionAvailable:!0,maxPreCompressionMB:Math.round(P/1024/1024)}):_("upload_blocked_size_limit",{fileName:p.name,fileSizeKB:Math.round(p.size/1024),fileType:p.type,uploadContext:o,maxSizeMB:Math.round(P/1024/1024),compressionAvailable:!1});continue}y.push(p),S&&M.push(p)}if(D.length+y.length>le){const p=Os(o,le);R({title:p.title,description:p.description,variant:"destructive"}),_("upload_blocked_file_count",{uploadContext:o,maxFiles:le,attemptedFiles:D.length+y.length});return}if(M.length===0){O(p=>[...p,...y]);return}F(!0);const K=Date.now();try{const p=await Bs(M,{maxWidth:1600,maxHeight:1600,quality:.78,maxSizeMB:v.targetSizeMB||1.2,stripEXIF:!0,convertFormat:!0},(x,b)=>{const C=M[x].name;Q(g=>({...g,[C]:b}))}),A=Date.now()-K,S=[],P=new Map,G=(v.targetSizeMB||1.2)*1024*1024;let ce=0;for(let x=0;x<y.length;x++){const b=y[x],C=D.length+x;if(ae(b)&&v.compressImages){const g=p[ce];if(g){if(g.success&&g.compressedSize>G){_("upload_image_blocked_size",{fileName:b.name,fileType:b.type,uploadContext:o,originalSizeKB:Math.round(b.size/1024),compressedSizeKB:Math.round(g.compressedSize/1024),targetSizeMB:v.targetSizeMB||1.2,width:g.width||null,height:g.height||null,dimensions:`${g.width||"unknown"}x${g.height||"unknown"}`,formatConverted:g.formatConverted||!1,compressionRatio:g.compressionRatio,compressionDurationMs:A,postCompression:!0,compressionSucceeded:!0,qualityUsed:.78}),R({title:"Photo couldn't be compressed enough",description:`${b.name} is still ${(g.compressedSize/1024/1024).toFixed(1)}MB after compression. Try taking a photo at a lower resolution, or use an image editing app to reduce the file size first.`,variant:"destructive"}),P.set(C,{success:!1,blocked:!0}),ce++;continue}g.success?(_("upload_image_compressed",{fileName:b.name,fileType:b.type,uploadContext:o,originalSizeKB:Math.round(b.size/1024),compressedSizeKB:Math.round(g.compressedSize/1024),targetSizeMB:v.targetSizeMB||1.2,width:g.width||null,height:g.height||null,dimensions:`${g.width||"unknown"}x${g.height||"unknown"}`,formatConverted:g.formatConverted||!1,compressionRatio:g.compressionRatio,compressionDurationMs:A,qualityUsed:.78,wasEnforced:!0,finalSizeValid:!0}),S.push(g.file),P.set(C,{success:g.success,blocked:g.blocked})):P.set(C,{success:!1,blocked:!0}),ce++}else S.push(b)}else S.push(b)}d(x=>new Map([...x,...P]));const z=p.filter(x=>x.success),we=p.filter(x=>x.blocked);if(z.length>0){const x=z.reduce((g,W)=>g+W.originalSize,0)/z.length,b=z.reduce((g,W)=>g+W.compressedSize,0)/z.length,C=((x-b)/x*100).toFixed(1);R({title:"Photos optimized successfully!",description:`${z.length} photo${z.length>1?"s":""} compressed and ready to upload. Saved ${C}% space on average while keeping quality high.`,variant:"default"}),_("compression_success",{uploadContext:o,filesCompressed:z.length,avgOriginalSizeKB:Math.round(x/1024),avgCompressedSizeKB:Math.round(b/1024),avgCompressionRatio:z.reduce((g,W)=>g+W.compressionRatio,0)/z.length,totalSizeSavedKB:Math.round((x-b)*z.length/1024),targetSizeMB:v.targetSizeMB||1.2})}if(we.length>0){we.forEach((x,b)=>{const C=M[b];R({title:"Couldn't optimize this photo",description:x.error||`${C.name} is still too large after compression. Try taking a new photo at lower resolution, or compress it with an image editing app first.`,variant:"destructive"}),_("upload_image_blocked_size",{fileName:C.name,originalSizeKB:Math.round(C.size/1024),fileType:C.type,uploadContext:o,targetSizeMB:v.targetSizeMB||1.2,postCompression:!0,compressionSucceeded:!1,error:x.error})});return}O(x=>[...x,...S])}catch(p){console.warn("Compression failed:",p),R({title:"Photo optimization skipped",description:"We'll upload your original photos as-is. They might take a bit longer to upload, but that's okay!",variant:"default"}),O(A=>[...A,...y])}finally{F(!1),Q({})}},[te,s,t,D.length,f]),bt=m.useCallback(u=>{O(N=>N.filter((y,M)=>M!==u))},[]),Nt=m.useCallback(async()=>{if(D.length!==0){c(!0),V(0);try{const u=[];for(let N=0;N<D.length;N++){const y=D[N],M=await fetch("/api/objects/upload",{method:"POST",headers:{"Content-Type":"application/json"}});if(!M.ok)throw new Error("Unable to start upload. Please check your connection and try again.");const{uploadURL:K}=await M.json();if(!(await fetch(K,{method:"PUT",body:y,headers:{"Content-Type":y.type}})).ok)throw new Error(`Couldn't upload ${y.name}. This might be a temporary connection issue - please try again.`);const A=await fetch("/api/objects/set-acl",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({objectURL:K.split("?")[0]})});if(!A.ok)throw new Error(`Upload completed but couldn't set permissions for ${y.name}. Please contact support if this continues.`);const{objectPath:S}=await A.json();u.push({id:crypto.randomUUID(),name:y.name,size:y.size,type:y.type,url:K.split("?")[0],objectPath:S}),V((N+1)/D.length*100)}oe(N=>[...N,...u]),O([]),i==null||i(u),R({title:"Upload complete!",description:`${u.length} file${u.length>1?"s":""} uploaded successfully and ready to use.`})}catch(u){console.error("Upload error:",u),R({title:"Upload didn't work",description:u instanceof Error?u.message:"Something went wrong with the upload. Please check your connection and try again.",variant:"destructive"})}finally{c(!1),V(0)}}},[D,i]),je=u=>u.startsWith("image/")?e.jsx(Fe,{className:"h-4 w-4"}):e.jsx(X,{className:"h-4 w-4"});return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("input",{type:"file",multiple:!0,accept:te.join(","),onChange:u=>wt(u.target.files),className:"hidden",id:"file-upload"}),e.jsx("label",{htmlFor:"file-upload",children:e.jsx(I,{type:"button",variant:"outline",className:n,disabled:h,asChild:!0,children:e.jsxs("div",{className:"cursor-pointer",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),l]})})}),j&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4 animate-spin"}),"Optimizing photos..."]}),Object.entries(L).map(([u,N])=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded bg-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm truncate",children:u}),e.jsx(k,{variant:"secondary",className:"text-xs",children:N.message})]}),e.jsx("div",{className:"w-16",children:e.jsx(fe,{value:N.progress,className:"h-2"})})]},u))]}),D.length>0&&!j&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-medium",children:["Selected Files:",e.jsxs("span",{className:"ml-1 text-xs text-gray-500",children:["(",D.length,"/",t,")"]})]}),D.map((u,N)=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[je(u.type),e.jsx("span",{className:"text-sm truncate",children:u.name}),e.jsxs(k,{variant:"secondary",className:"text-xs",children:[Math.round(u.size/1024),"KB"]}),(()=>{const y=r.get(N);return y&&y.success&&ae({type:u.type,size:u.size})&&f==="image"?e.jsx(k,{variant:"outline",className:"text-xs text-green-600",children:"Optimized"}):y&&y.blocked?e.jsx(k,{variant:"destructive",className:"text-xs",children:"Too Large"}):null})()]}),e.jsx(I,{type:"button",variant:"ghost",size:"sm",onClick:()=>bt(N),disabled:h,children:e.jsx(Et,{className:"h-4 w-4"})})]},N)),e.jsx(I,{type:"button",onClick:Nt,disabled:h||j,className:"w-full",children:h?"Uploading...":`Upload ${D.length} file(s)`}),h&&e.jsx(fe,{value:Z,className:"w-full"})]}),ee.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Uploaded Files:"}),ee.map(u=>e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded bg-green-50",children:[je(u.type),e.jsx("span",{className:"text-sm truncate",children:u.name}),e.jsxs(k,{variant:"secondary",className:"text-xs",children:[Math.round(u.size/1024),"KB"]}),e.jsx(k,{variant:"default",className:"text-xs ml-auto",children:"Uploaded"})]},u.id))]})]})})}const ke={coa:"Certificate of Analysis",license:"Business License",certificate:"Certificate",insurance:"Insurance Document",registration:"Registration Document"},Ls={coa:as,license:Oe,certificate:os,insurance:is,registration:X},Vs=se.object({documentType:se.enum(["coa","license","certificate","insurance","registration"],{required_error:"Please select a document type"}),description:se.string().optional(),expiryDate:se.string().optional().transform(t=>t===""?void 0:t)});function ea(){$t();const{toast:t}=_t(),[s,a]=m.useState("all"),[i,n]=m.useState(!1),[l,f]=m.useState([]),{data:o,isLoading:h}=It({queryKey:["/api/documents"],staleTime:60*1e3}),c=Ot({resolver:Wt(Vs),defaultValues:{documentType:void 0,description:"",expiryDate:""}}),j=be({mutationFn:async r=>await(await Te("POST","/api/documents",r)).json(),onSuccess:()=>{t({title:"Document uploaded",description:"Your document has been successfully uploaded and recorded."}),Me.invalidateQueries({queryKey:["/api/documents"]}),n(!1),c.reset(),f([])},onError:r=>{t({title:"Upload failed",description:r.message,variant:"destructive"})}}),F=be({mutationFn:async r=>await(await Te("DELETE",`/api/documents/${r}`)).json(),onSuccess:()=>{t({title:"Document deleted",description:"The document has been successfully deleted."}),Me.invalidateQueries({queryKey:["/api/documents"]})},onError:r=>{t({title:"Delete failed",description:r.message,variant:"destructive"})}}),L=r=>{f(r)};function Q(r){if(l.length===0){t({title:"No files uploaded",description:"Please upload at least one file before submitting.",variant:"destructive"});return}const d=l[0],w={fileName:d.name,originalName:d.name,fileSize:d.size,mimeType:d.type,objectPath:d.objectPath,documentType:r.documentType,description:r.description||void 0,expiryDate:r.expiryDate?new Date(r.expiryDate):void 0};j.mutate(w)}const Z=o?o.filter(r=>s==="all"?!0:r.documentType===s):[],V=r=>{if(r===0)return"0 Bytes";const d=1024,w=["Bytes","KB","MB","GB"],$=Math.floor(Math.log(r)/Math.log(d));return parseFloat((r/Math.pow(d,$)).toFixed(2))+" "+w[$]},D=r=>r?new Date(r).toLocaleDateString():"N/A",O=r=>{switch(r){case"approved":return e.jsx(k,{variant:"default",className:"bg-green-100 text-green-800",children:"Verified"});case"rejected":return e.jsx(k,{variant:"destructive",children:"Rejected"});case"pending":default:return e.jsx(k,{variant:"secondary",children:"Pending"})}},ee=async(r,d)=>{try{const w=await fetch(`/api/documents/${r}/download`,{credentials:"include"});if(!w.ok)throw new Error("Download failed");const $=await w.blob(),ne=window.URL.createObjectURL($),v=document.createElement("a");v.href=ne,v.download=d,document.body.appendChild(v),v.click(),v.remove(),window.URL.revokeObjectURL(ne)}catch{t({title:"Download failed",description:"Failed to download the document. Please try again.",variant:"destructive"})}},oe=[{accessorKey:"documentType",header:"Type",cell:({row:r})=>{const d=r.getValue("documentType"),w=Ls[d]||X;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{children:ke[d]||d})]})}},{accessorKey:"originalName",header:"File Name",cell:({row:r})=>e.jsx("div",{className:"max-w-[200px] truncate",children:r.getValue("originalName")})},{accessorKey:"fileSize",header:"Size",cell:({row:r})=>V(r.getValue("fileSize"))},{accessorKey:"createdAt",header:"Uploaded",cell:({row:r})=>D(r.getValue("createdAt"))},{accessorKey:"expiryDate",header:"Expires",cell:({row:r})=>{const d=r.getValue("expiryDate");if(!d)return"N/A";const w=new Date(d)<new Date,$=new Date(d).getTime()-Date.now()<30*24*60*60*1e3;return e.jsx("div",{className:`${w?"text-red-600":$?"text-yellow-600":""}`,children:D(d)})}},{accessorKey:"verificationStatus",header:"Status",cell:({row:r})=>O(r.getValue("verificationStatus"))},{id:"actions",header:"Actions",cell:({row:r})=>{const d=r.original;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>ee(d.id,d.originalName),"data-testid":`button-download-${d.id}`,children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsxs(ws,{children:[e.jsx(bs,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"sm","data-testid":`button-delete-${d.id}`,children:e.jsx(rs,{className:"h-4 w-4"})})}),e.jsxs(lt,{children:[e.jsxs(ct,{children:[e.jsx(mt,{children:"Delete Document"}),e.jsxs(ut,{children:['Are you sure you want to delete "',d.originalName,'"? This action cannot be undone.']})]}),e.jsxs(dt,{children:[e.jsx(gt,{children:"Cancel"}),e.jsx(pt,{onClick:()=>F.mutate(d.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})}}];return h?e.jsx(Ne,{children:e.jsx("div",{className:"container mx-auto py-6",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(he,{className:"h-8 w-8 animate-spin"})})})}):e.jsx(Ne,{children:e.jsxs("div",{className:"container mx-auto py-6 space-y-6","data-testid":"documents-page",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Document Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your compliance documents and certificates"})]}),e.jsxs(Yt,{open:i,onOpenChange:n,children:[e.jsx(Ht,{asChild:!0,children:e.jsxs(I,{"data-testid":"button-upload-document",children:[e.jsx(Ut,{className:"mr-2 h-4 w-4"}),"Upload Document"]})}),e.jsxs(Jt,{className:"sm:max-w-[500px]",children:[e.jsxs(Xt,{children:[e.jsx(Qt,{children:"Upload Document"}),e.jsx(Zt,{children:"Upload a new compliance document. Supported formats: PDF, DOC, DOCX, JPG, PNG"})]}),e.jsx(Lt,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(Q),className:"space-y-4",children:[e.jsx(de,{control:c.control,name:"documentType",render:({field:r})=>e.jsxs(me,{children:[e.jsx(ue,{children:"Document Type"}),e.jsxs(De,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(pe,{children:e.jsx(Se,{"data-testid":"select-document-type",children:e.jsx(Ce,{placeholder:"Select document type"})})}),e.jsxs(ze,{children:[e.jsx(T,{value:"coa",children:"Certificate of Analysis"}),e.jsx(T,{value:"license",children:"Business License"}),e.jsx(T,{value:"certificate",children:"Certificate"}),e.jsx(T,{value:"insurance",children:"Insurance Document"}),e.jsx(T,{value:"registration",children:"Registration Document"})]})]}),e.jsx(ge,{})]})}),e.jsx(de,{control:c.control,name:"description",render:({field:r})=>e.jsxs(me,{children:[e.jsx(ue,{children:"Description (Optional)"}),e.jsx(pe,{children:e.jsx(qt,{placeholder:"Add a description for this document...",...r,"data-testid":"input-description"})}),e.jsx(ge,{})]})}),e.jsx(de,{control:c.control,name:"expiryDate",render:({field:r})=>e.jsxs(me,{children:[e.jsx(ue,{children:"Expiry Date (Optional)"}),e.jsx(pe,{children:e.jsx(Vt,{type:"date",...r,"data-testid":"input-expiry-date"})}),e.jsx(Kt,{children:"Leave empty if the document doesn't expire"}),e.jsx(ge,{})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Upload File"}),e.jsx(Us,{maxNumberOfFiles:1,uploadType:"document",uploadContext:"compliance-docs",onFilesUploaded:L,buttonClassName:"w-full",children:e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(Ue,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-xs text-gray-500",children:"PDF, DOC, DOCX, JPG, PNG up to 10MB"})]})}),l.length>0&&e.jsxs("div",{className:"text-sm text-green-600",children:["âœ“ File uploaded: ",l[0].name]})]}),e.jsxs(es,{children:[e.jsx(I,{type:"button",variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsx(I,{type:"submit",disabled:j.isPending||l.length===0,"data-testid":"button-submit-document",children:j.isPending?e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):"Upload Document"})]})]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(q,{children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(H,{className:"text-sm font-medium",children:"Total Documents"}),e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(J,{children:e.jsx("div",{className:"text-2xl font-bold","data-testid":"stat-total-documents",children:(o==null?void 0:o.length)||0})})]}),e.jsxs(q,{children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(H,{className:"text-sm font-medium",children:"Verified"}),e.jsx(Oe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(J,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600","data-testid":"stat-verified-documents",children:(o==null?void 0:o.filter(r=>r.verificationStatus==="approved").length)||0})})]}),e.jsxs(q,{children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(H,{className:"text-sm font-medium",children:"Pending Review"}),e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(J,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600","data-testid":"stat-pending-documents",children:(o==null?void 0:o.filter(r=>r.verificationStatus==="pending").length)||0})})]}),e.jsxs(q,{children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(H,{className:"text-sm font-medium",children:"Expiring Soon"}),e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(J,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600","data-testid":"stat-expiring-documents",children:(o==null?void 0:o.filter(r=>{if(!r.expiryDate)return!1;const d=new Date(r.expiryDate),w=new Date;return w.setDate(w.getDate()+30),d<=w&&d>=new Date}).length)||0})})]})]}),e.jsxs(q,{children:[e.jsx(Y,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(H,{children:"Documents"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4"}),e.jsxs(De,{value:s,onValueChange:a,children:[e.jsx(Se,{className:"w-[200px]","data-testid":"filter-document-type",children:e.jsx(Ce,{placeholder:"Filter by type"})}),e.jsxs(ze,{children:[e.jsx(T,{value:"all",children:"All Documents"}),e.jsx(T,{value:"coa",children:"Certificate of Analysis"}),e.jsx(T,{value:"license",children:"Business License"}),e.jsx(T,{value:"certificate",children:"Certificate"}),e.jsx(T,{value:"insurance",children:"Insurance"}),e.jsx(T,{value:"registration",children:"Registration"})]})]})]})]})}),e.jsx(J,{children:Z.length===0?e.jsxs("div",{className:"text-center py-8","data-testid":"no-documents-message",children:[e.jsx(X,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No documents"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:s==="all"?"Get started by uploading your first document.":`No ${ke[s]} documents found.`})]}):e.jsx(Gt,{columns:oe,data:Z,searchKey:"originalName",searchPlaceholder:"Search documents..."})})]})]})})}export{ea as default};

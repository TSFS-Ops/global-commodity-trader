import{k as O,l as $,r as f,j as e,M,aT as H,m as T,n as y,b as t,b0 as k,q as K,s as Q,t as h,v as j,o as i,a3 as r,a4 as n,p as c,at as m,a1 as u,g as W,Q as b,I as w,B as S,b1 as Y,F as g}from"./index-DE3WvtMD.js";import{A as V,C as X,S as z}from"./scroll-area-DRcAvLaD.js";import{D as J}from"./database-BF2X_8bV.js";function se(){const{user:C}=O(),{toast:v}=$(),[E,R]=f.useState("overview"),[D,P]=f.useState("HEMP-USD,CANNABIS-USD"),[N,A]=f.useState({startDate:new Date(Date.now()-7*24*60*60*1e3).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0]});if(!C||C.role!=="admin")return e.jsx(M,{children:e.jsx("div",{className:"container mx-auto py-10",children:e.jsxs("div",{className:"text-center",children:[e.jsx(H,{className:"mx-auto h-12 w-12 text-destructive mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Admin Access Required"}),e.jsx("p",{className:"text-muted-foreground",children:"This dashboard is only available to platform administrators. If you should have access, please contact your system administrator."})]})})});const{data:l,isLoading:F}=T({queryKey:["/api/logs/recent"],queryFn:async()=>await(await g("GET","/api/logs/recent?limit=50")).json(),refetchInterval:3e4}),{data:p}=T({queryKey:["/api/permissions/my-permissions"],queryFn:async()=>await(await g("GET","/api/permissions/my-permissions")).json()}),x=y({mutationFn:async s=>await(await g("POST","/api/external-data/market-prices",{symbols:s})).json(),onSuccess:()=>{v({title:"Market prices refreshed!",description:"We've got the latest market data and it's ready to view."})},onError:s=>{v({title:"Couldn't fetch market data",description:`There was a problem getting the latest prices: ${s.message}. This might be temporary - try again in a moment.`,variant:"destructive"})}}),d=y({mutationFn:async s=>await(await g("POST","/api/logs/audit-report",s)).json(),onSuccess:()=>{v({title:"Audit report ready!",description:"Your audit report has been generated and is ready to download or view."})}}),o=y({mutationFn:async()=>await(await g("GET","/api/matching/suggestions")).json()}),L=()=>{const s=D.split(",").map(a=>a.trim()).filter(Boolean);s.length>0&&x.mutate(s)},B=()=>{d.mutate(N)},G=s=>{const a={info:"default",warning:"secondary",error:"destructive",security:"destructive",audit:"outline"};return e.jsx(t,{variant:a[s]||"default",children:s})},I=s=>new Date(s).toLocaleString();return e.jsx(M,{children:e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Admin Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Platform architecture management and monitoring"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(t,{variant:"outline",className:"text-sm",children:[e.jsx(k,{className:"w-3 h-3 mr-1"}),"Admin Access"]})})]}),e.jsxs(K,{value:E,onValueChange:R,className:"space-y-4",children:[e.jsxs(Q,{className:"grid w-full grid-cols-5",children:[e.jsx(h,{value:"overview",children:"Overview"}),e.jsx(h,{value:"logging",children:"Logging & Audit"}),e.jsx(h,{value:"matching",children:"Matching Engine"}),e.jsx(h,{value:"external",children:"External Data"}),e.jsx(h,{value:"permissions",children:"Permissions"})]}),e.jsxs(j,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(i,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"System Status"}),e.jsx(V,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:"Running Smoothly"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All platform services are healthy"})]})]}),e.jsxs(i,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Recent Logs"}),e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(l==null?void 0:l.length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 50 entries"})]})]}),e.jsxs(i,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Security Events"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(l==null?void 0:l.filter(s=>s.level==="security").length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Security-related logs"})]})]}),e.jsxs(i,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Data Sources"}),e.jsx(J,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"4"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"External integrations"})]})]})]}),e.jsxs(i,{children:[e.jsxs(r,{children:[e.jsx(n,{children:"Architecture Components Status"}),e.jsx(m,{children:"Real-time status of key platform components"})]}),e.jsx(c,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Matching Engine"}),e.jsxs(t,{variant:"default",className:"text-green-600",children:[e.jsx(u,{className:"w-3 h-3 mr-1"}),"Active"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Logging Service"}),e.jsxs(t,{variant:"default",className:"text-green-600",children:[e.jsx(u,{className:"w-3 h-3 mr-1"}),"Active"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Permissions Module"}),e.jsxs(t,{variant:"default",className:"text-green-600",children:[e.jsx(u,{className:"w-3 h-3 mr-1"}),"Active"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"External Data Service"}),e.jsxs(t,{variant:"default",className:"text-green-600",children:[e.jsx(u,{className:"w-3 h-3 mr-1"}),"Active"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Blockchain Integration"}),e.jsxs(t,{variant:"secondary",className:"text-yellow-600",children:[e.jsx(W,{className:"w-3 h-3 mr-1"}),"Mock Mode"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"WebSocket Server"}),e.jsxs(t,{variant:"default",className:"text-green-600",children:[e.jsx(u,{className:"w-3 h-3 mr-1"}),"Active"]})]})]})]})})]})]}),e.jsx(j,{value:"logging",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(i,{children:[e.jsxs(r,{children:[e.jsx(n,{children:"Recent System Logs"}),e.jsx(m,{children:"Latest system events and activities"})]}),e.jsx(c,{children:e.jsx(z,{className:"h-[400px]",children:F?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading logs..."})}):e.jsx("div",{className:"space-y-2",children:(l==null?void 0:l.map((s,a)=>e.jsxs("div",{className:"border rounded p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[G(s.level),e.jsx("span",{className:"text-xs text-muted-foreground",children:I(s.timestamp)})]}),e.jsx("div",{className:"font-medium",children:s.service}),e.jsx("div",{className:"text-muted-foreground",children:s.message})]},a)))||e.jsx("div",{className:"text-sm text-muted-foreground",children:"No logs available"})})})})]}),e.jsxs(i,{children:[e.jsxs(r,{children:[e.jsx(n,{children:"Generate Audit Report"}),e.jsx(m,{children:"Create detailed audit reports for compliance"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"startDate",children:"Start Date"}),e.jsx(w,{id:"startDate",type:"date",value:N.startDate,onChange:s=>A(a=>({...a,startDate:s.target.value}))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"endDate",children:"End Date"}),e.jsx(w,{id:"endDate",type:"date",value:N.endDate,onChange:s=>A(a=>({...a,endDate:s.target.value}))})]}),e.jsx(S,{onClick:B,disabled:d.isPending,className:"w-full",children:d.isPending?"Generating...":"Generate Report"}),d.data&&e.jsxs("div",{className:"mt-4 p-4 bg-muted rounded space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Audit Report Summary"}),e.jsxs("div",{className:"grid gap-1 text-sm",children:[e.jsxs("div",{children:["Total Actions: ",d.data.totalActions]}),e.jsxs("div",{children:["Successful: ",d.data.successfulActions]}),e.jsxs("div",{children:["Failed: ",d.data.failedActions]}),e.jsxs("div",{children:["Security Events: ",d.data.securityEvents]})]})]})]})]})]})}),e.jsx(j,{value:"matching",className:"space-y-4",children:e.jsxs(i,{children:[e.jsxs(r,{children:[e.jsx(n,{children:"Matching Engine"}),e.jsx(m,{children:"Advanced buyer-seller matching algorithms"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsx(S,{onClick:()=>o.mutate(),disabled:o.isPending,children:o.isPending?"Generating...":"Generate Matching Suggestions"}),o.data&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Matching Results"}),e.jsx("div",{className:"grid gap-3",children:o.data.map((s,a)=>e.jsxs(i,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h5",{className:"font-medium",children:s.listing.title}),e.jsxs(t,{variant:"outline",children:[Math.round(s.compatibilityScore*100),"% match"]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Seller: ",s.seller.fullName," | ",s.estimatedDeliveryTime]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.matchingFactors.map((q,U)=>e.jsx(t,{variant:"secondary",className:"text-xs",children:q},U))})]},a))})]})]})]})}),e.jsx(j,{value:"external",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(i,{children:[e.jsxs(r,{children:[e.jsx(n,{children:"Market Data Feed"}),e.jsx(m,{children:"Real-time market price information"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"symbols",children:"Market Symbols (comma-separated)"}),e.jsx(w,{id:"symbols",value:D,onChange:s=>P(s.target.value),placeholder:"HEMP-USD,CANNABIS-USD,EXTRACT-USD"})]}),e.jsx(S,{onClick:L,disabled:x.isPending,className:"w-full",children:x.isPending?"Fetching...":"Fetch Market Data"}),x.data&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Market Prices"}),x.data.map((s,a)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.symbol}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.productType})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:["$",s.price.toFixed(2)]}),e.jsx("div",{className:`text-xs ${s.priceChange24h&&s.priceChange24h>0?"text-green-600":"text-red-600"}`,children:s.priceChange24h?`${s.priceChange24h>0?"+":""}${s.priceChange24h.toFixed(2)}%`:"N/A"})]})]},a))]})]})]}),e.jsxs(i,{children:[e.jsxs(r,{children:[e.jsx(n,{children:"External Data Sources"}),e.jsx(m,{children:"Connected external systems and registries"})]}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Partner System A"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Product verification service"})]}),e.jsx(t,{variant:"default",className:"text-green-600",children:"Connected"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Public Registry B"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"License verification"})]}),e.jsx(t,{variant:"default",className:"text-green-600",children:"Connected"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Market Price Feeds"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Real-time pricing data"})]}),e.jsx(t,{variant:"default",className:"text-green-600",children:"Connected"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Regulatory Data Sources"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Compliance information"})]}),e.jsx(t,{variant:"default",className:"text-green-600",children:"Connected"})]})]})})]})]})}),e.jsx(j,{value:"permissions",className:"space-y-4",children:e.jsxs(i,{children:[e.jsxs(r,{children:[e.jsx(n,{children:"Permission System"}),e.jsx(m,{children:"Role-based access control and user permissions"})]}),e.jsx(c,{children:p&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2",children:["Your Role: ",p.role]}),e.jsx("div",{className:"grid gap-2 md:grid-cols-2 lg:grid-cols-3",children:p.permissions.map((s,a)=>e.jsxs(t,{variant:"outline",className:"justify-start",children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),s]},a))})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Permission Categories"}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-1",children:"Listings"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Control access to product listings"})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-1",children:"Orders"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Manage order operations"})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-1",children:"Users"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"User account management"})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-1",children:"External Data"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Access to external systems"})]})]})]})]})})]})})]})]})})}export{se as default};

import{c as ee,k as se,l as ae,u as te,r as P,m as re,n as D,j as e,M as m,L as u,a8 as h,B as r,o as j,a3 as p,a4 as g,at as M,p as N,P as T,b as O,S as ne,av as X,H as le,J as ie,K as ce,N as de,O as f,aC as oe,F as A,G as v,g as xe,a0 as me,aa as ue}from"./index-DE3WvtMD.js";import{D as he,b as je,a as pe,c as ge,d as Ne,e as fe,f as ve}from"./dialog-BEaSUMTJ.js";import{T as ye}from"./textarea-DxM8kpuO.js";import{A as be}from"./arrow-left-CBn638CS.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=ee("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);function Te(){var $,U,L,B,F,R,q,K,Q,H,V,Y;const{user:t}=se(),{toast:i}=ae(),l=te().id,[c,k]=P.useState(""),[d,G]=P.useState(""),[J,y]=P.useState(!1),{data:s,isLoading:Z}=re({queryKey:[`/api/orders/${l}`],enabled:!!l,staleTime:60*1e3}),b=D({mutationFn:async a=>await(await A("PATCH",`/api/orders/${l}`,{status:a})).json(),onSuccess:()=>{i({title:"Status updated",description:"The order status has been successfully updated."}),v.invalidateQueries({queryKey:[`/api/orders/${l}`]}),v.invalidateQueries({queryKey:["/api/orders"]}),y(!1)},onError:a=>{i({title:"Update failed",description:a.message,variant:"destructive"})}}),w=D({mutationFn:async a=>{if(!s)throw new Error("Order not found");const x={receiverId:(t==null?void 0:t.role)==="seller"?s.buyerId:s.sellerId,content:a,relatedOrderId:l};return await(await A("POST","/api/messages",x)).json()},onSuccess:()=>{i({title:"Message sent",description:"Your message has been sent successfully."}),k("")},onError:a=>{i({title:"Message failed",description:a.message,variant:"destructive"})}}),C=D({mutationFn:async()=>await(await A("PATCH",`/api/orders/${l}`,{status:"cancelled"})).json(),onSuccess:()=>{i({title:"Order cancelled",description:"The order has been cancelled successfully."}),v.invalidateQueries({queryKey:[`/api/orders/${l}`]}),v.invalidateQueries({queryKey:["/api/orders"]})},onError:a=>{i({title:"Cancellation failed",description:a.message,variant:"destructive"})}}),z=()=>{d&&b.mutate(d)},W=()=>{c.trim()&&w.mutate(c)},_=()=>{C.mutate()},S=a=>{try{return oe(new Date(a),"PPP")}catch{return"Unknown date"}},E=a=>{const x={pending:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(xe,{className:"mr-2 h-4 w-4"})},processing:{color:"bg-blue-100 text-blue-800",icon:e.jsx(T,{className:"mr-2 h-4 w-4"})},completed:{color:"bg-green-100 text-green-800",icon:e.jsx(me,{className:"mr-2 h-4 w-4"})},cancelled:{color:"bg-red-100 text-red-800",icon:e.jsx(ue,{className:"mr-2 h-4 w-4"})}}[a]||{color:"bg-neutral-100 text-neutral-800",icon:e.jsx(T,{className:"mr-2 h-4 w-4"})};return e.jsx(O,{className:`${x.color} border-0 text-sm py-1 px-3`,children:e.jsxs("span",{className:"flex items-center",children:[x.icon,a.charAt(0).toUpperCase()+a.slice(1)]})})};if(Z)return e.jsx(m,{children:e.jsx("div",{className:"flex justify-center items-center h-[60vh]",children:e.jsx(u,{className:"h-8 w-8 animate-spin text-primary"})})});if(!s)return e.jsx(m,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-neutral-800 mb-2",children:"Order Not Found"}),e.jsx("p",{className:"text-neutral-600 mb-6",children:"The order you're looking for doesn't exist or you don't have permission to view it."}),e.jsx(h,{href:"/orders",children:e.jsx(r,{children:"Return to Orders"})})]})});const n=(t==null?void 0:t.id)===s.buyerId,o=(t==null?void 0:t.id)===s.sellerId;return!n&&!o?e.jsx(m,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-neutral-800 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-neutral-600 mb-6",children:"You don't have permission to view this order."}),e.jsx(h,{href:"/orders",children:e.jsx(r,{children:"Return to Orders"})})]})}):e.jsxs(m,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(h,{href:"/orders",children:e.jsxs(r,{variant:"ghost",className:"mb-4 pl-0 text-neutral-600 hover:text-neutral-900",children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Back to Orders"]})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-neutral-800",children:["Order #",s.id]}),e.jsxs("p",{className:"text-neutral-600",children:["Placed on ",S(s.createdAt)]})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:E(s.status)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[e.jsxs(j,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"Order Details"}),e.jsx(M,{children:"Complete information about this order"})]}),e.jsxs(N,{className:"space-y-6",children:[e.jsx("div",{className:"rounded-lg bg-neutral-50 p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-16 h-16 rounded bg-primary/10 flex items-center justify-center mr-4 flex-shrink-0",children:e.jsx(T,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-lg",children:(($=s.listing)==null?void 0:$.title)||`Product #${s.listingId}`}),e.jsx("p",{className:"text-neutral-600 text-sm",children:((U=s.listing)==null?void 0:U.description)||"No description available"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx(O,{variant:"outline",children:((L=s.listing)==null?void 0:L.category)||"Unknown Category"}),s.transactionId&&e.jsxs(O,{variant:"outline",children:["TXN: ",s.transactionId]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-neutral-500",children:"QUANTITY"}),e.jsxs("p",{className:"text-lg",children:[s.quantity," ",((B=s.listing)==null?void 0:B.unit)||"units"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-neutral-500",children:"PRICE PER UNIT"}),e.jsxs("p",{className:"text-lg",children:["$",((R=(F=s.listing)==null?void 0:F.pricePerUnit)==null?void 0:R.toFixed(2))||"N/A"]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-neutral-500",children:"TOTAL PRICE"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",s.totalPrice.toFixed(2)]})]})]}),e.jsx(ne,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-neutral-500",children:"DELIVERY ADDRESS"}),e.jsx("p",{className:"text-neutral-800",children:s.deliveryAddress||"No delivery address provided"})]}),s.notes&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-neutral-500",children:"NOTES"}),e.jsx("p",{className:"text-neutral-800",children:s.notes})]})]})]}),e.jsxs(j,{children:[e.jsxs(p,{children:[e.jsxs(g,{children:["Contact ",n?"Seller":"Buyer"]}),e.jsx(M,{children:"Send a message about this order"})]}),e.jsx(N,{children:e.jsx(ye,{placeholder:`Message to ${n?(q=s.seller)==null?void 0:q.username:(K=s.buyer)==null?void 0:K.username}...`,className:"min-h-[120px]",value:c,onChange:a=>k(a.target.value)})}),e.jsx(X,{className:"justify-end",children:e.jsxs(r,{onClick:W,disabled:!c.trim()||w.isPending,children:[w.isPending&&e.jsx(u,{className:"mr-2 h-4 w-4 animate-spin"}),"Send Message"]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(j,{children:[e.jsxs(p,{children:[e.jsx(g,{children:o?"Manage Order":"Order Status"}),e.jsx(M,{children:o?"Update the status of this order":"Current status and actions"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Status"}),E(s.status)]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Date Placed"}),e.jsx("span",{className:"font-medium",children:S(s.createdAt)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Last Updated"}),e.jsx("span",{className:"font-medium",children:S(s.updatedAt)})]}),s.transactionId&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Transaction ID"}),e.jsx("span",{className:"font-medium text-sm",children:s.transactionId})]})]}),e.jsxs(X,{className:"flex-col items-stretch gap-2",children:[o&&s.status!=="completed"&&s.status!=="cancelled"&&e.jsxs(he,{open:J,onOpenChange:y,children:[e.jsx(je,{asChild:!0,children:e.jsx(r,{variant:"default",className:"w-full",children:"Update Status"})}),e.jsxs(pe,{children:[e.jsxs(ge,{children:[e.jsx(Ne,{children:"Update Order Status"}),e.jsx(fe,{children:"Change the current status of this order"})]}),e.jsx("div",{className:"py-4",children:e.jsxs(le,{value:d,onValueChange:G,children:[e.jsx(ie,{children:e.jsx(ce,{placeholder:"Select new status"})}),e.jsxs(de,{children:[e.jsx(f,{value:"pending",children:"Pending"}),e.jsx(f,{value:"processing",children:"Processing"}),e.jsx(f,{value:"completed",children:"Completed"}),e.jsx(f,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsxs(ve,{children:[e.jsx(r,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsxs(r,{onClick:z,disabled:!d||b.isPending,children:[b.isPending&&e.jsx(u,{className:"mr-2 h-4 w-4 animate-spin"}),"Update Status"]})]})]})]}),n&&s.status==="pending"&&e.jsxs(r,{variant:"destructive",onClick:_,disabled:C.isPending,children:[C.isPending&&e.jsx(u,{className:"mr-2 h-4 w-4 animate-spin"}),"Cancel Order"]}),e.jsx(r,{variant:"outline",className:"w-full",asChild:!0,children:e.jsxs(h,{href:`/messages?${n?`sellerId=${s.sellerId}`:`buyerId=${s.buyerId}`}`,children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"View Messages"]})})]})]}),e.jsxs(j,{children:[e.jsx(p,{children:e.jsxs(g,{children:[n?"Seller":"Buyer"," Information"]})}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1 text-neutral-500",children:"NAME"}),e.jsx("p",{className:"font-medium",children:n?((Q=s.seller)==null?void 0:Q.username)||`Seller #${s.sellerId}`:((H=s.buyer)==null?void 0:H.username)||`Buyer #${s.buyerId}`})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1 text-neutral-500",children:"EMAIL"}),e.jsx("p",{children:n?((V=s.seller)==null?void 0:V.email)||"Not available":((Y=s.buyer)==null?void 0:Y.email)||"Not available"})]})]})]})]})]})]})}export{Te as default};

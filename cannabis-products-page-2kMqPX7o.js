import{c as le,k as $,l as ae,r as f,n as ne,j as e,o as ce,ag as K,b as V,p as oe,w as de,g as xe,S as Y,B as y,I as h,L,D as me,F as re,G as k,aC as he,aw as x,ak as ue,am as je,an as u,ao as j,as as p,aq as g,ar as v,aD as pe,al as ge,m as R,M as ve,a9 as ye,H as G,J,K as W,N as X,O as m,q as Ne,s as Ce,t as Z,v as _,ad as T}from"./index-DE3WvtMD.js";import{D as O,b as H,a as U,c as A,d as I,e as M,f as fe}from"./dialog-BEaSUMTJ.js";import{S as we}from"./square-pen-Bnp_w1Ld.js";import{C as be}from"./circle-check-L_0MTdEX.js";import{T as De}from"./textarea-DxM8kpuO.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=le("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);function se({cannabisProduct:t,isOwner:o}){const{user:w}=$(),{toast:a}=ae(),[C,N]=f.useState(!1),[s,r]=f.useState(1),i=ne({mutationFn:async c=>await(await re("POST","/api/orders",c)).json(),onSuccess:()=>{a({title:"Purchase successful!",description:"You have successfully purchased this cannabis product."}),k.invalidateQueries({queryKey:["/api/cannabis-products"]}),k.invalidateQueries({queryKey:["/api/orders"]}),N(!1)},onError:c=>{a({title:"Purchase failed",description:c.message,variant:"destructive"})}}),b=()=>{if(!w){a({title:"Authentication required",description:"Please log in to purchase cannabis products",variant:"destructive"});return}if(s<=0||s>t.quantity){a({title:"Invalid quantity",description:`Please enter a quantity between 1 and ${t.quantity}`,variant:"destructive"});return}const c={listingId:-t.id,sellerId:t.ownerId,quantity:s,totalPrice:s*(t.pricePerUnit||0),notes:`Purchase of ${s} ${t.unit}s of ${t.productName}, strain: ${t.strain}`};i.mutate(c)},D=c=>c?he(new Date(c),"MMM d, yyyy"):"N/A",S=D(t.harvestDate),q=D(t.createdAt),P=s*(t.pricePerUnit||0);return e.jsxs(ce,{className:"overflow-hidden hover:shadow-md transition",children:[e.jsxs("div",{className:"h-40 bg-primary/10 relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(K,{className:"h-16 w-16 text-primary/40"})}),t.certificationStandard&&e.jsx(V,{className:"absolute top-2 right-2 bg-primary text-white",children:t.certificationStandard})]}),e.jsxs(oe,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-neutral-800 font-medium",children:t.productName}),e.jsx("p",{className:"text-sm text-neutral-600 line-clamp-2",children:t.description||"No description available"})]}),o&&e.jsx(V,{variant:"outline",className:"border-primary text-primary",children:"Your Product"})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm text-neutral-600",children:[e.jsx(de,{size:16,className:"mr-1 text-neutral-500"}),e.jsx("span",{children:t.location})]}),t.strain&&e.jsxs("div",{className:"flex items-center text-sm text-neutral-600",children:[e.jsx(K,{size:16,className:"mr-1 text-neutral-500"}),e.jsxs("span",{children:["Strain: ",t.strain]})]}),(t.thcContent||t.cbdContent)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-neutral-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{size:16,className:"mr-1 text-neutral-500"}),e.jsxs("span",{children:["THC: ",t.thcContent||"Unknown","%"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{size:16,className:"mr-1 text-neutral-500"}),e.jsxs("span",{children:["CBD: ",t.cbdContent||"Unknown","%"]})]})]}),e.jsxs("div",{className:"flex items-center text-sm text-neutral-600",children:[e.jsx(xe,{size:16,className:"mr-1 text-neutral-500"}),e.jsx("span",{children:S==="N/A"?`Listed on ${q}`:`Harvested: ${S}`})]})]}),e.jsx(Y,{className:"my-3"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-600",children:"Available"}),e.jsxs("p",{className:"text-lg font-semibold text-neutral-800",children:[t.quantity," ",t.unit||"units"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-neutral-600",children:["Price per ",t.unit||"unit"]}),e.jsx("p",{className:"text-lg font-semibold text-neutral-800",children:t.pricePerUnit?`$${t.pricePerUnit.toFixed(2)}`:"Contact for pricing"})]})]}),e.jsx("div",{className:"mt-3",children:o?e.jsxs(y,{className:"w-full",variant:"outline",children:[e.jsx(we,{size:16,className:"mr-2"}),"Edit Product"]}):e.jsxs(O,{open:C,onOpenChange:N,children:[e.jsx(H,{asChild:!0,children:e.jsxs(y,{className:"w-full bg-primary text-white hover:bg-primary-dark",children:[e.jsx(be,{size:16,className:"mr-2"}),"Purchase Product"]})}),e.jsxs(U,{children:[e.jsxs(A,{children:[e.jsx(I,{children:"Purchase Cannabis Product"}),e.jsxs(M,{children:["Select the quantity of ",t.productName," (",t.strain,") you wish to purchase."]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Available quantity:"}),e.jsxs("span",{className:"font-medium",children:[t.quantity," ",t.unit||"units"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-neutral-600",children:["Price per ",t.unit||"unit",":"]}),e.jsx("span",{className:"font-medium",children:t.pricePerUnit?`$${t.pricePerUnit.toFixed(2)}`:"Contact for pricing"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"quantity",className:"text-neutral-600",children:"Quantity:"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(y,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-r-none",onClick:()=>r(Math.max(1,s-1)),disabled:s<=1,children:"-"}),e.jsx(h,{id:"quantity",type:"number",min:1,max:t.quantity,value:s,onChange:c=>r(parseInt(c.target.value)||1),className:"h-8 w-20 rounded-none text-center"}),e.jsx(y,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-l-none",onClick:()=>r(Math.min(t.quantity,s+1)),disabled:s>=t.quantity,children:"+"})]})]}),e.jsx(Y,{}),e.jsxs("div",{className:"flex items-center justify-between text-lg",children:[e.jsx("span",{className:"font-medium",children:"Total:"}),e.jsxs("span",{className:"font-bold",children:["$",P.toFixed(2)]})]})]}),e.jsxs(fe,{children:[e.jsx(y,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsxs(y,{className:"bg-primary hover:bg-primary-dark",onClick:b,disabled:i.isPending,children:[i.isPending?e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(me,{className:"mr-2 h-4 w-4"}),"Complete Purchase"]})]})]})]})})]})]})}const Se=x.object({productName:x.string().min(3,"Product name must be at least 3 characters"),strain:x.string().min(2,"Strain name must be at least 2 characters"),location:x.string().min(3,"Location must be at least 3 characters"),quantity:x.coerce.number().positive("Quantity must be positive"),pricePerUnit:x.coerce.number().positive("Price must be positive").optional(),thcContent:x.coerce.number().min(0,"THC content cannot be negative").max(100,"THC content cannot exceed 100%").optional(),cbdContent:x.coerce.number().min(0,"CBD content cannot be negative").max(100,"CBD content cannot exceed 100%").optional(),description:x.string().optional(),certificationStandard:x.string().optional(),harvestDate:x.string().optional()}).omit({ownerId:!0});function te({onSuccess:t}){const{toast:o}=ae(),{user:w}=$(),a=ue({resolver:ge(Se),defaultValues:{productName:"",strain:"",location:"",quantity:0,pricePerUnit:void 0,thcContent:void 0,cbdContent:void 0,description:"",certificationStandard:"",harvestDate:""}}),C=ne({mutationFn:async s=>{const r={...s,harvestDate:s.harvestDate?new Date(s.harvestDate).toISOString():void 0};return await(await re("POST","/api/cannabis-products",r)).json()},onSuccess:()=>{o({title:"Product registered!",description:"Your cannabis product has been successfully registered."}),k.invalidateQueries({queryKey:["/api/cannabis-products"]}),a.reset(),t&&t()},onError:s=>{o({title:"Registration failed",description:s.message,variant:"destructive"})}});function N(s){if(!w){o({title:"Authentication required",description:"Please log in to register cannabis products",variant:"destructive"});return}C.mutate(s)}return e.jsx(je,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(N),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(u,{control:a.control,name:"productName",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"Product Name"}),e.jsx(g,{children:e.jsx(h,{placeholder:"Premium Cannabis Flower",...s})}),e.jsx(v,{})]})}),e.jsx(u,{control:a.control,name:"strain",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"Strain"}),e.jsx(g,{children:e.jsx(h,{placeholder:"Durban Poison",...s})}),e.jsx(v,{})]})})]}),e.jsx(u,{control:a.control,name:"location",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"Location"}),e.jsx(g,{children:e.jsx(h,{placeholder:"Eastern Cape, South Africa",...s})}),e.jsx(pe,{children:"Where the product was grown or produced"}),e.jsx(v,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(u,{control:a.control,name:"quantity",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"Quantity"}),e.jsx(g,{children:e.jsx(h,{type:"number",min:"0",step:"0.01",...s})}),e.jsx(v,{})]})}),e.jsx(u,{control:a.control,name:"pricePerUnit",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"Price per Unit ($)"}),e.jsx(g,{children:e.jsx(h,{type:"number",min:"0",step:"0.01",placeholder:"Optional",...s,value:s.value===void 0?"":s.value,onChange:r=>{const i=r.target.value===""?void 0:parseFloat(r.target.value);s.onChange(i)}})}),e.jsx(v,{})]})}),e.jsx(u,{control:a.control,name:"certificationStandard",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"Certification"}),e.jsx(g,{children:e.jsx(h,{placeholder:"Optional",...s})}),e.jsx(v,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(u,{control:a.control,name:"thcContent",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"THC Content (%)"}),e.jsx(g,{children:e.jsx(h,{type:"number",min:"0",max:"100",step:"0.1",placeholder:"Optional",...s,value:s.value===void 0?"":s.value,onChange:r=>{const i=r.target.value===""?void 0:parseFloat(r.target.value);s.onChange(i)}})}),e.jsx(v,{})]})}),e.jsx(u,{control:a.control,name:"cbdContent",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"CBD Content (%)"}),e.jsx(g,{children:e.jsx(h,{type:"number",min:"0",max:"100",step:"0.1",placeholder:"Optional",...s,value:s.value===void 0?"":s.value,onChange:r=>{const i=r.target.value===""?void 0:parseFloat(r.target.value);s.onChange(i)}})}),e.jsx(v,{})]})}),e.jsx(u,{control:a.control,name:"harvestDate",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"Harvest Date"}),e.jsx(g,{children:e.jsx(h,{type:"date",...s})}),e.jsx(v,{})]})})]}),e.jsx(u,{control:a.control,name:"description",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"Description"}),e.jsx(g,{children:e.jsx(De,{placeholder:"Describe your cannabis product in detail...",className:"min-h-[100px]",...s})}),e.jsx(v,{})]})}),e.jsxs(y,{type:"submit",className:"w-full bg-primary hover:bg-primary-dark",disabled:C.isPending,children:[C.isPending?e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Create Cannabis Listing"]})]})})}function ke(){const{user:t}=$(),[o,w]=f.useState(""),[a,C]=f.useState("newest"),[N,s]=f.useState("all"),[r,i]=f.useState(!1),{data:b,isLoading:D}=R({queryKey:["/api/cannabis-products"],staleTime:60*1e3}),{data:S,isLoading:q}=R({queryKey:[`/api/cannabis-products?ownerId=${t==null?void 0:t.id}`],enabled:!!t,staleTime:60*1e3}),P=b?["all",...new Set(b.map(n=>n.location))]:["all"],c=n=>n?n.filter(l=>{var z,B,E;const d=o===""||((z=l.productName)==null?void 0:z.toLowerCase().includes(o.toLowerCase()))||((B=l.strain)==null?void 0:B.toLowerCase().includes(o.toLowerCase()))||((E=l.description)==null?void 0:E.toLowerCase().includes(o.toLowerCase())),ie=N==="all"||l.location===N;return d&&ie}).sort((l,d)=>{switch(a){case"newest":return new Date(d.createdAt).getTime()-new Date(l.createdAt).getTime();case"oldest":return new Date(l.createdAt).getTime()-new Date(d.createdAt).getTime();case"price-asc":return(l.pricePerUnit||0)-(d.pricePerUnit||0);case"price-desc":return(d.pricePerUnit||0)-(l.pricePerUnit||0);case"thc-asc":return(l.thcContent||0)-(d.thcContent||0);case"thc-desc":return(d.thcContent||0)-(l.thcContent||0);case"cbd-asc":return(l.cbdContent||0)-(d.cbdContent||0);case"cbd-desc":return(d.cbdContent||0)-(l.cbdContent||0);case"quantity-asc":return l.quantity-d.quantity;case"quantity-desc":return d.quantity-l.quantity;default:return 0}}):[],F=c(b),Q=c(S);return e.jsx(ve,{children:e.jsxs("div",{className:"container py-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-primary",children:"Cannabis Listings"}),e.jsxs("div",{className:"flex mt-4 sm:mt-0 gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(h,{type:"text",placeholder:"Search products...",className:"pl-8 max-w-[200px]",value:o,onChange:n=>w(n.target.value)})]}),e.jsxs(G,{value:N,onValueChange:s,children:[e.jsx(J,{className:"w-[160px]",children:e.jsx(W,{placeholder:"Filter by location"})}),e.jsx(X,{children:P.map(n=>e.jsx(m,{value:n,children:n==="all"?"All Locations":n},n))})]}),e.jsxs(G,{value:a,onValueChange:C,children:[e.jsx(J,{className:"w-[160px]",children:e.jsx(W,{placeholder:"Sort by"})}),e.jsxs(X,{children:[e.jsx(m,{value:"newest",children:"Newest First"}),e.jsx(m,{value:"oldest",children:"Oldest First"}),e.jsx(m,{value:"price-asc",children:"Price: Low to High"}),e.jsx(m,{value:"price-desc",children:"Price: High to Low"}),e.jsx(m,{value:"thc-asc",children:"THC: Low to High"}),e.jsx(m,{value:"thc-desc",children:"THC: High to Low"}),e.jsx(m,{value:"cbd-asc",children:"CBD: Low to High"}),e.jsx(m,{value:"cbd-desc",children:"CBD: High to Low"}),e.jsx(m,{value:"quantity-asc",children:"Quantity: Low to High"}),e.jsx(m,{value:"quantity-desc",children:"Quantity: High to Low"})]})]})]})]}),e.jsxs(Ne,{defaultValue:"market",className:"w-full",children:[e.jsxs(Ce,{className:"mb-6",children:[e.jsx(Z,{value:"market",children:"Marketplace"}),e.jsx(Z,{value:"my-products",children:"My Listings"})]}),e.jsx(_,{value:"market",children:D?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(L,{className:"h-8 w-8 animate-spin text-primary"})}):F.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-lg text-gray-500",children:"No cannabis listings found"}),t&&e.jsxs(y,{className:"mt-4 bg-primary",onClick:()=>i(!0),children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Create Cannabis Listing"]})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:F.map(n=>e.jsx(se,{cannabisProduct:n,isOwner:t&&t.id===n.ownerId},n.id))})}),e.jsx(_,{value:"my-products",children:t?q?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(L,{className:"h-8 w-8 animate-spin text-primary"})}):Q.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-lg text-gray-500",children:"You haven't created any cannabis listings yet"}),e.jsxs(O,{open:r,onOpenChange:i,children:[e.jsx(H,{asChild:!0,children:e.jsxs(y,{className:"mt-4 bg-primary",children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Create Cannabis Listing"]})}),e.jsxs(U,{className:"max-w-2xl",children:[e.jsxs(A,{children:[e.jsx(I,{children:"Create Cannabis Listing"}),e.jsx(M,{children:"Provide details about your cannabis listing to publish it on the marketplace."})]}),e.jsx(te,{onSuccess:()=>i(!1)})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(O,{open:r,onOpenChange:i,children:[e.jsx(H,{asChild:!0,children:e.jsxs(y,{className:"bg-primary",children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Create Cannabis Listing"]})}),e.jsxs(U,{className:"max-w-2xl",children:[e.jsxs(A,{children:[e.jsx(I,{children:"Create Cannabis Listing"}),e.jsx(M,{children:"Provide details about your cannabis listing to publish it on the marketplace."})]}),e.jsx(te,{onSuccess:()=>i(!1)})]})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:Q.map(n=>e.jsx(se,{cannabisProduct:n,isOwner:!0},n.id))})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-lg text-gray-500",children:"Please log in to view your listings"})})})]})]})})}export{ke as default};

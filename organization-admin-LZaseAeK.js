import{c as V,i as H,k as U,l as X,r as w,m as f,n as A,j as e,M as _,o as c,a3 as l,a4 as o,at as C,b as k,g as T,a2 as J,p as m,b8 as E,D as W,q as Y,s as Z,t as F,v as q,au as $,B as d,b1 as ee,F as x,G as u,a5 as I}from"./index-DE3WvtMD.js";import{D as se,a as te,c as ae,d as ie,e as ne,f as re}from"./dialog-BEaSUMTJ.js";import{B as ce}from"./building-2-Di7O9HAg.js";import{C as D}from"./circle-check-L_0MTdEX.js";import{T as R}from"./triangle-alert-Bwh9XQm5.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=V("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);function he(){const L=H(),{user:h}=U(),{toast:j}=X(),[a,S]=w.useState(null),[P,g]=w.useState(!1);w.useEffect(()=>{h&&h.role!=="seller"&&L("/dashboard")},[h,L]);const{data:n,isLoading:M}=f({queryKey:["/api/seller/organization"],queryFn:async()=>await(await x("GET","/api/seller/organization")).json()}),{data:i,isLoading:v}=f({queryKey:["/api/seller/organization/stats"],queryFn:async()=>await(await x("GET","/api/seller/organization/stats")).json()}),{data:N,isLoading:z}=f({queryKey:["/api/seller/mandate-invitations"],queryFn:async()=>await(await x("GET","/api/seller/mandate-invitations")).json()}),{data:y,isLoading:B}=f({queryKey:["/api/seller/active-mandates"],queryFn:async()=>await(await x("GET","/api/seller/active-mandates")).json()}),r=A({mutationFn:async({invitationId:s,action:t})=>await(await x("POST",`/api/seller/mandate-invitations/${s}/respond`,{action:t})).json(),onSuccess:(s,{action:t})=>{j({title:t==="accept"?"Mandate accepted!":"Invitation declined",description:t==="accept"?"The broker can now manage listings on your behalf.":"The invitation has been declined."}),u.invalidateQueries({queryKey:["/api/seller/mandate-invitations"]}),u.invalidateQueries({queryKey:["/api/seller/active-mandates"]}),u.invalidateQueries({queryKey:["/api/seller/organization/stats"]}),g(!1)},onError:s=>{j({title:"Failed to respond to invitation",description:s.message,variant:"destructive"})}}),K=A({mutationFn:async s=>await(await x("POST",`/api/seller/mandates/${s}/terminate`)).json(),onSuccess:()=>{j({title:"Mandate terminated",description:"The broker's access has been revoked."}),u.invalidateQueries({queryKey:["/api/seller/active-mandates"]}),u.invalidateQueries({queryKey:["/api/seller/organization/stats"]})},onError:s=>{j({title:"Failed to terminate mandate",description:s.message,variant:"destructive"})}}),b=s=>{const t={pending:{variant:"secondary",icon:T,color:"text-yellow-600"},accepted:{variant:"default",icon:D,color:"text-green-600"},rejected:{variant:"outline",icon:I,color:"text-red-600"},expired:{variant:"destructive",icon:R,color:"text-red-600"},active:{variant:"default",icon:D,color:"text-green-600"},suspended:{variant:"secondary",icon:R,color:"text-yellow-600"},terminated:{variant:"destructive",icon:I,color:"text-red-600"}},p=t[s]||t.pending,G=p.icon;return e.jsxs(k,{variant:p.variant,className:p.color,children:[e.jsx(G,{className:"w-3 h-3 mr-1"}),s.charAt(0).toUpperCase()+s.slice(1)]})},O=[{header:"Broker",accessorKey:"brokerName"},{header:"Email",accessorKey:"brokerEmail"},{header:"Commission",accessorKey:"commissionRate",cell:({row:s})=>{const t=s.original;return t.commissionType==="percent"?`${t.commissionRate}%`:`$${t.commissionRate}`}},{header:"Status",accessorKey:"status",cell:({row:s})=>b(s.original.status)},{header:"Expires",accessorKey:"expiresAt",cell:({row:s})=>new Date(s.original.expiresAt).toLocaleDateString()},{header:"Actions",cell:({row:s})=>{const t=s.original;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>{S(t),g(!0)},children:e.jsx(ee,{className:"w-3 h-3"})}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>r.mutate({invitationId:t.id,action:"accept"}),disabled:r.isPending,className:"text-green-600 hover:text-green-700",children:"Accept"}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>r.mutate({invitationId:t.id,action:"reject"}),disabled:r.isPending,className:"text-red-600 hover:text-red-700",children:"Decline"})]})]})}}],Q=[{header:"Broker",accessorKey:"brokerName"},{header:"Email",accessorKey:"brokerEmail"},{header:"Commission",accessorKey:"commissionRate",cell:({row:s})=>{const t=s.original;return t.commissionType==="percent"?`${t.commissionRate}%`:`$${t.commissionRate}`}},{header:"Status",accessorKey:"status",cell:({row:s})=>b(s.original.status)},{header:"Listings",accessorKey:"totalListings"},{header:"Total Paid",accessorKey:"totalCommissions",cell:({row:s})=>`$${(s.original.totalCommissions||0).toFixed(2)}`},{header:"Actions",cell:({row:s})=>{const t=s.original;return t.status==="active"?e.jsx(d,{variant:"outline",size:"sm",onClick:()=>K.mutate(t.id),disabled:K.isPending,className:"text-red-600 hover:text-red-700",children:"Terminate"}):null}}];return h?e.jsx(_,{children:e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-[#173c1e]",children:"Organization Admin"}),e.jsx("p",{className:"text-[#173c1e]/70",children:"Manage your organization, broker relationships, and mandates"})]})}),e.jsx(c,{className:"mb-6",children:e.jsxs(l,{children:[e.jsxs(o,{className:"flex items-center text-[#173c1e]",children:[e.jsx(ce,{className:"w-5 h-5 mr-2"}),M?"Loading...":(n==null?void 0:n.name)||"Organization"]}),e.jsx(C,{children:M?"Loading organization details...":e.jsxs(e.Fragment,{children:[(n==null?void 0:n.region)&&`Located in ${n.region} â€¢ `,n!=null&&n.isVerified?e.jsxs(k,{variant:"default",className:"text-green-600",children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),"Verified"]}):e.jsxs(k,{variant:"secondary",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),"Verification Pending"]})]})})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[e.jsxs(c,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Total Listings"}),e.jsx(J,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold text-[#173c1e]",children:v?"...":(i==null?void 0:i.totalListings)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active products"})]})]}),e.jsxs(c,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Active Mandates"}),e.jsx(E,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold text-[#173c1e]",children:v?"...":(i==null?void 0:i.activeMandates)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Broker partnerships"})]})]}),e.jsxs(c,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Pending Invites"}),e.jsx(T,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold text-[#173c1e]",children:v?"...":(i==null?void 0:i.pendingInvitations)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Awaiting response"})]})]}),e.jsxs(c,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Commissions Paid"}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-2xl font-bold text-[#173c1e]",children:["$",v?"...":((i==null?void 0:i.totalCommissionsPaid)||0).toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total broker fees"})]})]})]}),e.jsxs(Y,{defaultValue:"invitations",className:"space-y-4",children:[e.jsxs(Z,{className:"grid w-full grid-cols-2",children:[e.jsx(F,{value:"invitations",children:"Mandate Invitations"}),e.jsx(F,{value:"mandates",children:"Active Mandates"})]}),e.jsx(q,{value:"invitations",children:e.jsxs(c,{children:[e.jsxs(l,{children:[e.jsxs(o,{className:"flex items-center text-[#173c1e]",children:[e.jsx(le,{className:"w-5 h-5 mr-2"}),"Mandate Invitations"]}),e.jsx(C,{children:"Review and respond to broker mandate invitations"})]}),e.jsx(m,{children:z?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading invitations..."})}):N&&N.length>0?e.jsx($,{columns:O,data:N}):e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"No mandate invitations found."})})})]})}),e.jsx(q,{value:"mandates",children:e.jsxs(c,{children:[e.jsxs(l,{children:[e.jsxs(o,{className:"flex items-center text-[#173c1e]",children:[e.jsx(E,{className:"w-5 h-5 mr-2"}),"Active Mandates"]}),e.jsx(C,{children:"Manage your active broker relationships and performance"})]}),e.jsx(m,{children:B?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading mandates..."})}):y&&y.length>0?e.jsx($,{columns:Q,data:y}):e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"No active mandates found. Accept broker invitations to get started."})})})]})})]}),e.jsx(se,{open:P,onOpenChange:g,children:e.jsxs(te,{className:"sm:max-w-[500px]",children:[e.jsxs(ae,{children:[e.jsx(ie,{children:"Mandate Invitation Details"}),e.jsx(ne,{children:"Review the full details of this broker mandate invitation"})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Broker Name"}),e.jsx("p",{className:"text-sm",children:a.brokerName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsx("p",{className:"text-sm",children:a.brokerEmail})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Commission Type"}),e.jsx("p",{className:"text-sm",children:a.commissionType==="percent"?"Percentage":"Flat Rate"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Commission Rate"}),e.jsx("p",{className:"text-sm",children:a.commissionType==="percent"?`${a.commissionRate}%`:`$${a.commissionRate}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx("div",{className:"mt-1",children:b(a.status)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Expires"}),e.jsx("p",{className:"text-sm",children:new Date(a.expiresAt).toLocaleDateString()})]})]}),a.description&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-sm mt-1",children:a.description})]})]}),e.jsxs(re,{children:[e.jsx(d,{variant:"outline",onClick:()=>g(!1),children:"Close"}),(a==null?void 0:a.status)==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(d,{variant:"outline",onClick:()=>a&&r.mutate({invitationId:a.id,action:"reject"}),disabled:r.isPending,className:"text-red-600 hover:text-red-700",children:"Decline"}),e.jsx(d,{onClick:()=>a&&r.mutate({invitationId:a.id,action:"accept"}),disabled:r.isPending,className:"bg-[#173c1e] text-white hover:bg-[#173c1e]/90",children:"Accept Mandate"})]})]})]})})]})}):null}export{he as default};

import{u as se,i as ae,k as re,l as te,a6 as ie,r as ne,m as Y,ak as le,n as ce,j as e,o as d,a3 as N,p as o,aT as z,B as u,a4 as A,at as $,b as R,D as de,P as H,w as oe,ap as me,A as V,E as Z,b1 as xe,y as F,g as ue,am as he,an as h,ao as g,as as j,aq as p,aD as ge,ar as f,I as b,a1 as je,aw as m,ag as v,al as pe,F as fe}from"./index-DE3WvtMD.js";import{T as ye}from"./textarea-DxM8kpuO.js";import{A as Ne}from"./arrow-left-CBn638CS.js";import{S as be}from"./send-DgBiCyZR.js";const ve=m.object({message:m.string().min(20,"Message must be at least 20 characters"),offerPrice:m.number().positive("Offer price must be positive").optional(),offerQuantity:m.number().positive("Offer quantity must be positive").optional(),availableQuantity:m.number().positive("Available quantity must be positive").optional(),deliveryTime:m.string().optional()});function Ae(){var D,q,M,B;const{id:l}=se(),T=ae(),{user:i}=re(),{toast:Q}=te(),G=ie(),[J,w]=ne.useState(!1),{data:c,isLoading:W}=Y({queryKey:[`/api/buy-signals/${l}`],enabled:!!l}),{data:S}=Y({queryKey:[`/api/buy-signals/${l}/responses`],enabled:!!l&&!!(i!=null&&i.id)&&!!((q=(D=c==null?void 0:c.signal)==null?void 0:D.buyer)!=null&&q.id)}),t=le({resolver:pe(ve),defaultValues:{message:""}}),y=ce({mutationFn:async s=>await fe(`/api/buy-signals/${l}/responses`,"POST",s),onSuccess:()=>{Q({title:"Response Sent",description:"Your response has been sent to the buyer."}),G.invalidateQueries({queryKey:[`/api/buy-signals/${l}`]}),w(!1),t.reset()},onError:s=>{Q({title:"Error Sending Response",description:s.message||"Failed to send response. Please try again.",variant:"destructive"})}}),X=async s=>{await y.mutateAsync(s)};if(W)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2 mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-8"}),e.jsxs(d,{children:[e.jsxs(N,{children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})})]})]})});const a=c==null?void 0:c.signal,C=(S==null?void 0:S.responses)||[];if(!a)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(d,{children:e.jsxs(o,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(z,{className:"h-12 w-12 text-red-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Signal Not Found"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"This buy signal may have been removed or you don't have access to view it."}),e.jsx(u,{className:"mt-4",onClick:()=>T("/buy-signals"),children:"Back to Signals"})]})})});const _={low:"bg-gray-100 text-gray-800",normal:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"},L={cannabis:e.jsx(v,{className:"h-5 w-5"}),hemp:e.jsx(v,{className:"h-5 w-5"}),cbd:e.jsx(v,{className:"h-5 w-5"}),thc:e.jsx(v,{className:"h-5 w-5"}),equipment:e.jsx(H,{className:"h-5 w-5"}),services:e.jsx(F,{className:"h-5 w-5"})},ee=(s,r,x="USD")=>{const n=x==="USD"?"$":x==="ZAR"?"R":"â‚¬";return s&&r?`${n}${s.toLocaleString()} - ${n}${r.toLocaleString()}`:s?`${n}${s.toLocaleString()}+`:r?`Up to ${n}${r.toLocaleString()}`:"Negotiable"},P=(i==null?void 0:i.id)===a.buyer.id,k=i&&!P&&a.isActive;return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(u,{variant:"ghost",onClick:()=>T("/buy-signals"),className:"mb-4",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Back to Buy Signals"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(A,{className:"text-2xl mb-2 flex items-center gap-3",children:[L[a.category],e.jsx("span",{children:a.title})]}),e.jsx($,{className:"text-base",children:a.description})]}),e.jsxs("div",{className:"flex flex-col gap-2 shrink-0",children:[e.jsxs(R,{className:_[a.urgency],children:[a.urgency," priority"]}),!a.isActive&&e.jsx(R,{variant:"secondary",children:"Inactive"})]})]})}),e.jsxs(o,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(a.budgetMin||a.budgetMax)&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 rounded-lg",children:[e.jsx(de,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-900",children:"Budget Range"}),e.jsx("div",{className:"text-green-700",children:ee(a.budgetMin,a.budgetMax,a.currency)})]})]}),a.targetQuantity&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 rounded-lg",children:[e.jsx(H,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-blue-900",children:"Target Quantity"}),e.jsxs("div",{className:"text-blue-700",children:[a.targetQuantity," ",a.unit||"units"]})]})]}),a.preferredLocation&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-orange-50 rounded-lg",children:[e.jsx(oe,{className:"h-5 w-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-orange-900",children:"Preferred Location"}),e.jsx("div",{className:"text-orange-700",children:a.preferredLocation})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-purple-50 rounded-lg",children:[L[a.category],e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-purple-900",children:"Category"}),e.jsx("div",{className:"text-purple-700 capitalize",children:a.category})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Posted by"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{children:e.jsxs(Z,{children:[(M=a.buyer.firstName)==null?void 0:M[0],(B=a.buyer.lastName)==null?void 0:B[0]]})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.buyer.firstName&&a.buyer.lastName?`${a.buyer.firstName} ${a.buyer.lastName}`:a.buyer.username}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["@",a.buyer.username]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-muted-foreground border-t pt-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsxs("span",{children:[a.viewCount," views"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsxs("span",{children:[a.responseCount," responses"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsxs("span",{children:["Posted ",new Date(a.createdAt).toLocaleDateString()]})]}),a.expiresAt&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsxs("span",{children:["Expires ",new Date(a.expiresAt).toLocaleDateString()]})]})]})]})]}),k&&e.jsxs(d,{children:[e.jsxs(N,{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"Respond to this Signal"]}),e.jsx($,{children:"Send your offer and details to the buyer"})]}),e.jsx(o,{children:J?e.jsx(he,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(X),className:"space-y-4",children:[e.jsx(h,{control:t.control,name:"message",render:({field:s})=>e.jsxs(g,{children:[e.jsx(j,{children:"Your Message *"}),e.jsx(p,{children:e.jsx(ye,{placeholder:"Describe your offer, availability, and any relevant details...",className:"min-h-[100px]",...s})}),e.jsx(ge,{children:"Provide details about how you can fulfill this request"}),e.jsx(f,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(h,{control:t.control,name:"offerPrice",render:({field:s})=>e.jsxs(g,{children:[e.jsx(j,{children:"Offer Price (per unit)"}),e.jsx(p,{children:e.jsx(b,{type:"number",step:"0.01",placeholder:"0.00",...s,onChange:r=>s.onChange(r.target.value?Number(r.target.value):void 0)})}),e.jsx(f,{})]})}),e.jsx(h,{control:t.control,name:"offerQuantity",render:({field:s})=>e.jsxs(g,{children:[e.jsx(j,{children:"Offer Quantity"}),e.jsx(p,{children:e.jsx(b,{type:"number",step:"0.01",placeholder:"0",...s,onChange:r=>s.onChange(r.target.value?Number(r.target.value):void 0)})}),e.jsx(f,{})]})}),e.jsx(h,{control:t.control,name:"availableQuantity",render:({field:s})=>e.jsxs(g,{children:[e.jsx(j,{children:"Total Available"}),e.jsx(p,{children:e.jsx(b,{type:"number",step:"0.01",placeholder:"0",...s,onChange:r=>s.onChange(r.target.value?Number(r.target.value):void 0)})}),e.jsx(f,{})]})}),e.jsx(h,{control:t.control,name:"deliveryTime",render:({field:s})=>e.jsxs(g,{children:[e.jsx(j,{children:"Delivery Time"}),e.jsx(p,{children:e.jsx(b,{placeholder:"e.g., 2-3 business days",...s})}),e.jsx(f,{})]})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>w(!1),disabled:y.isPending,children:"Cancel"}),e.jsx(u,{type:"submit",disabled:y.isPending,className:"min-w-[120px]",children:y.isPending?"Sending...":"Send Response"})]})]})}):e.jsx(u,{onClick:()=>w(!0),className:"w-full",children:"Create Response"})})]}),P&&C.length>0&&e.jsxs(d,{children:[e.jsxs(N,{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"}),"Responses (",C.length,")"]}),e.jsx($,{children:"Responses from sellers interested in your request"})]}),e.jsx(o,{children:e.jsx("div",{className:"space-y-4",children:C.map((s,r)=>{var x,n,E,O,I,U,K;return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"h-8 w-8",children:e.jsxs(Z,{children:[(n=(x=s.seller)==null?void 0:x.firstName)==null?void 0:n[0],(O=(E=s.seller)==null?void 0:E.lastName)==null?void 0:O[0]]})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:(I=s.seller)!=null&&I.firstName&&((U=s.seller)!=null&&U.lastName)?`${s.seller.firstName} ${s.seller.lastName}`:(K=s.seller)==null?void 0:K.username}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString()})]})]}),!s.isRead&&e.jsx(R,{variant:"secondary",className:"text-xs",children:"New"})]}),e.jsx("p",{className:"text-sm mb-3",children:s.message}),(s.offerPrice||s.offerQuantity||s.deliveryTime)&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 text-xs text-muted-foreground bg-gray-50 p-3 rounded",children:[s.offerPrice&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Price:"})," $",s.offerPrice]}),s.offerQuantity&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Quantity:"})," ",s.offerQuantity]}),s.deliveryTime&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Delivery:"})," ",s.deliveryTime]})]})]},s.id)})})})]}),!k&&!P&&e.jsx(d,{children:e.jsxs(o,{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(je,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"font-medium mb-2",children:"Cannot Respond"}),e.jsx("p",{className:"text-muted-foreground text-center",children:a.isActive?"You need to be logged in to respond to buy signals.":"This buy signal is no longer active."})]})})]})]})}export{Ae as default};

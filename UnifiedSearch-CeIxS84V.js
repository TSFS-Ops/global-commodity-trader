import{c as Y,j as e,o as V,a as q,p as W,B as v,b as j,r as u,m as G,a9 as T,I as ae,aa as O,S as ne,h as Q,ab as ie,ac as oe,ad as K,ae as le,af as ce,w as de,ag as me,l as he,ah as ue,ai as ge,aj as xe}from"./index-DE3WvtMD.js";import{a as pe}from"./http-DXHry6-L.js";import{F as U}from"./filter-BKVlahs0.js";import{T as $}from"./triangle-alert-Bwh9XQm5.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=Y("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=Y("PackageX",[["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}],["path",{d:"m17 13 5 5m-5 0 5-5",key:"im3w4b"}]]);function fe({icon:l,title:s,description:r,variant:i="default",actions:c=[],suggestions:w=[],className:g}){const N=()=>{switch(i){case"search-pre":return"border-dashed border-2 border-green-200 bg-gradient-to-br from-green-50 to-green-100/50";case"search-narrow":return"border-dashed border-2 border-yellow-200 bg-gradient-to-br from-yellow-50 to-yellow-100/50";case"search-zero":return"border-dashed border-2 border-blue-200 bg-gradient-to-br from-blue-50 to-blue-100/50";case"search-error":return"border-dashed border-2 border-red-200 bg-gradient-to-br from-red-50 to-red-100/50";default:return"border-dashed border-2 border-muted-foreground/20"}},m=()=>{switch(i){case"search-pre":return"text-green-600";case"search-narrow":return"text-yellow-600";case"search-zero":return"text-blue-600";case"search-error":return"text-red-600";default:return"text-muted-foreground/60"}};return e.jsx(V,{className:q(N(),g),children:e.jsxs(W,{className:"flex flex-col items-center justify-center text-center p-8",children:[l&&e.jsx("div",{className:q("mb-4",m()),children:l}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:s}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md",children:r}),c.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-4 justify-center",children:c.map((a,o)=>e.jsx(v,{variant:a.variant||"default",onClick:a.onClick,className:"flex items-center gap-2",...a.href&&{asChild:!0},children:a.href?e.jsxs("a",{href:a.href,className:"flex items-center gap-2",children:[a.icon&&a.icon,a.label]}):e.jsxs(e.Fragment,{children:[a.icon&&a.icon,a.label]})},o))}),w.length>0&&e.jsxs("div",{className:"text-sm text-muted-foreground w-full max-w-md",children:[e.jsx("p",{className:"font-medium mb-3",children:"Try these suggestions:"}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:w.map((a,o)=>typeof a=="string"?e.jsx(j,{variant:"outline",className:"cursor-default",children:a},o):e.jsxs(j,{variant:"outline",className:q("cursor-pointer hover:bg-primary/10 transition-colors",a.onClick&&"hover:bg-accent hover:text-accent-foreground"),onClick:a.onClick,children:[a.text,a.badge&&e.jsxs("span",{className:"ml-1 text-xs opacity-60",children:["(",a.badge,")"]})]},o))})]})]})})}function ye({onSearch:l,placeholder:s="What are you looking for? Try 'CBD oil', 'hemp seeds', or 'cannabis flower'...",isLoading:r=!1}){var D,_;const[i,c]=u.useState(""),[w,g]=u.useState(!1),[N,m]=u.useState(!1),[a,o]=u.useState({}),[b,F]=u.useState([]),C=u.useRef(null),E=u.useRef(null);u.useEffect(()=>{const t=localStorage.getItem("cannabis-search-history");if(t)try{F(JSON.parse(t))}catch{console.warn("Couldn't load your search history - no worries, we'll start fresh!")}},[]);const R=t=>{if(!t.trim())return;const n=[t,...b.filter(I=>I!==t)].slice(0,5);F(n),localStorage.setItem("cannabis-search-history",JSON.stringify(n))},{data:y=[]}=G({queryKey:["/api/search/suggestions",i],queryFn:async()=>{if(!i.trim()||i.length<2)return[];const t=await fetch(`/api/search/suggestions?q=${encodeURIComponent(i)}`);return t.ok?(await t.json()).suggestions||[]:[]},enabled:i.length>=2,staleTime:5*60*1e3}),p=[{name:"Cannabis",count:"120+"},{name:"Hemp",count:"85+"},{name:"CBD",count:"67+"},{name:"THC",count:"43+"}],P=["Western Cape","Eastern Cape","KwaZulu-Natal","Gauteng"],A=t=>{const n=t.target.value;c(n),g(n.length>0)},x=t=>{const n=t||i;n.trim()&&(R(n),l(n,a),g(!1))},z=t=>{c(t.text),x(t.text)},S=t=>{t.key==="Enter"?x():t.key==="Escape"&&g(!1)},H=()=>{var t;c(""),g(!1),(t=C.current)==null||t.focus()},M=t=>{const n=a.category||[];n.includes(t)||o({...a,category:[...n,t]})},B=t=>{var n;o({...a,category:(n=a.category)==null?void 0:n.filter(I=>I!==t)})};u.useEffect(()=>{const t=n=>{E.current&&!E.current.contains(n.target)&&(g(!1),m(!1))};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const k=t=>{switch(t){case"recent":return e.jsx(X,{size:16,className:"text-gray-400"});case"popular":return e.jsx(Q,{size:16,className:"text-orange-500"});case"category":return e.jsx(j,{variant:"secondary",className:"text-xs",children:"Category"});case"location":return e.jsx(j,{variant:"outline",className:"text-xs",children:"Location"});default:return e.jsx(T,{size:16,className:"text-gray-400"})}};return e.jsxs("div",{ref:E,className:"relative w-full max-w-2xl",children:[e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(ae,{ref:C,type:"text",value:i,onChange:A,onKeyDown:S,onFocus:()=>g(i.length>0||b.length>0),placeholder:s,className:"pl-10 pr-20 h-12 text-base border-2 border-gray-200 focus:border-[#a8c566] focus:ring-[#a8c566]/20",disabled:r}),e.jsxs("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 flex items-center gap-1",children:[i&&e.jsx(v,{variant:"ghost",size:"sm",onClick:H,className:"h-8 w-8 p-0",children:e.jsx(O,{size:16})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>m(!N),className:q("h-8 w-8 p-0",N&&"bg-[#a8c566]/20 text-[#173c1e]"),children:e.jsx(U,{size:16})}),e.jsx(v,{onClick:()=>x(),disabled:r||!i.trim(),className:"bg-[#173c1e] hover:bg-[#173c1e]/90 text-white px-4 h-8",children:r?"Looking...":"Find It"})]})]}),(((D=a.category)==null?void 0:D.length)||a.region)&&e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[(_=a.category)==null?void 0:_.map(t=>e.jsxs(j,{variant:"secondary",className:"bg-[#a8c566]/20 text-[#173c1e] hover:bg-[#a8c566]/30",children:[t,e.jsx(O,{size:12,className:"ml-1 cursor-pointer",onClick:()=>B(t)})]},t)),a.region&&e.jsxs(j,{variant:"outline",children:["ðŸ“ ",a.region,e.jsx(O,{size:12,className:"ml-1 cursor-pointer",onClick:()=>o({...a,region:void 0})})]})]}),N&&e.jsx(V,{className:"absolute top-full left-0 right-0 mt-2 z-50 border-2 border-gray-100 shadow-lg",children:e.jsx(W,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Browse by Category"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:p.map(t=>e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>M(t.name.toLowerCase()),className:"text-xs h-8",children:[t.name," ",e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",t.count,")"]})]},t.name))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Shop by Region"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:P.map(t=>e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>o({...a,region:t}),className:"text-xs h-8",children:["ðŸ“ ",t]},t))})]})]})})}),w&&(i.length>0||b.length>0)&&e.jsx(V,{className:"absolute top-full left-0 right-0 mt-1 z-40 border-2 border-gray-100 shadow-lg max-h-96 overflow-y-auto",children:e.jsxs(W,{className:"p-0",children:[!i&&b.length>0&&e.jsxs("div",{className:"p-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-600 mb-2 flex items-center",children:[e.jsx(X,{size:14,className:"mr-1"}),"Your Recent Searches"]}),b.map((t,n)=>e.jsxs("div",{onClick:()=>z({id:t,text:t,type:"recent"}),className:"flex items-center py-2 px-3 hover:bg-gray-50 cursor-pointer rounded text-sm",children:[e.jsx(T,{size:14,className:"text-gray-400 mr-2"}),t]},n)),e.jsx(ne,{className:"mt-2"})]}),i.length>0&&e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600 mb-2",children:"You might be looking for..."}),y.length>0?y.map(t=>{var n;return e.jsxs("div",{onClick:()=>z(t),className:"flex items-center justify-between py-2 px-3 hover:bg-gray-50 cursor-pointer rounded text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[k(t.type),e.jsx("span",{className:"ml-2",children:t.text})]}),((n=t.metadata)==null?void 0:n.count)&&e.jsxs("span",{className:"text-xs text-gray-400",children:[t.metadata.count," results"]})]},t.id)}):i.length>=2&&e.jsxs("div",{className:"py-2 px-3 text-sm text-gray-500",children:['No suggestions for "',i,'" yet. Try a different search term, or browse categories below.']})]}),!i&&e.jsxs("div",{className:"p-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-600 mb-2 flex items-center",children:[e.jsx(Q,{size:14,className:"mr-1"}),"Popular Right Now"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:p.map(t=>e.jsxs("div",{onClick:()=>z({id:t.name,text:t.name.toLowerCase(),type:"category"}),className:"flex items-center justify-between py-2 px-3 hover:bg-gray-50 cursor-pointer rounded text-sm",children:[e.jsx("span",{children:t.name}),e.jsx("span",{className:"text-xs text-gray-400",children:t.count})]},t.name))})]})]})})]})}function ve(l){return l.isError?"error":!l.query&&!l.hasFilters?"pre-search":l.total===0&&l.hasFilters?"narrow-filters":l.total===0?"zero-supply":"pre-search"}function ee(l,s){switch(l){case"pre-search":return{type:"pre-search",variant:"search-pre",icon:e.jsx(T,{size:48}),title:"Start exploring cannabis products",description:"Search our marketplace to find premium cannabis, hemp, CBD, and wellness products from verified South African sellers.",actions:[{label:"Browse All Listings",href:"/browse",variant:"outline",icon:e.jsx(me,{size:16})},{label:"Create Listing",onClick:s.onCreateListing,icon:e.jsx(K,{size:16})}],suggestions:[{text:"Cannabis flowers",onClick:()=>{var r;return(r=s.onSearchSuggestion)==null?void 0:r.call(s,"cannabis flowers")},badge:"120+"},{text:"CBD oil",onClick:()=>{var r;return(r=s.onSearchSuggestion)==null?void 0:r.call(s,"cbd oil")},badge:"85+"},{text:"Hemp products",onClick:()=>{var r;return(r=s.onSearchSuggestion)==null?void 0:r.call(s,"hemp products")},badge:"67+"},{text:"Western Cape",onClick:()=>{var r;return(r=s.onSearchSuggestion)==null?void 0:r.call(s,"western cape")},badge:"200+"}],telemetryEvent:"search_empty_pre"};case"narrow-filters":return{type:"narrow-filters",variant:"search-narrow",icon:e.jsx(U,{size:48}),title:"No results with current filters",description:"Your search filters might be too specific. Try broadening your search by removing some filters or expanding your criteria.",actions:[{label:"Clear all filters",onClick:s.onClearFilters,icon:e.jsx(ce,{size:16})},{label:"Search all regions",onClick:()=>{var r;return(r=s.onClearFilters)==null?void 0:r.call(s)},variant:"outline",icon:e.jsx(de,{size:16})}],suggestions:["Try searching in all regions","Remove price filters","Include unverified sellers","Broaden product category"],telemetryEvent:"search_empty_narrow"};case"zero-supply":return{type:"zero-supply",variant:"search-zero",icon:e.jsx(Z,{size:48}),title:"No products found",description:"We don't currently have products matching your search. Be the first to list this product or set up an alert for when it becomes available.",actions:[{label:"Create listing",onClick:s.onCreateListing,icon:e.jsx(K,{size:16})},{label:"Set up alert",onClick:s.onSetupAlert,variant:"outline",icon:e.jsx(le,{size:16})}],suggestions:[{text:"Similar cannabis products",onClick:()=>{var r;return(r=s.onSearchSuggestion)==null?void 0:r.call(s,"cannabis")},badge:"50+"},{text:"Hemp alternatives",onClick:()=>{var r;return(r=s.onSearchSuggestion)==null?void 0:r.call(s,"hemp")},badge:"30+"},{text:"CBD products",onClick:()=>{var r;return(r=s.onSearchSuggestion)==null?void 0:r.call(s,"cbd")},badge:"45+"}],telemetryEvent:"search_empty_zero"};case"error":return{type:"error",variant:"search-error",icon:e.jsx($,{size:48}),title:"Something went wrong",description:"We're having trouble loading search results right now. Please try again, or browse our featured listings while we fix this.",actions:[{label:"Try again",onClick:s.onRetrySearch,icon:e.jsx(ie,{size:16})},{label:"Browse featured",href:"/browse?featured=true",variant:"outline",icon:e.jsx(oe,{size:16})}],suggestions:["Check your internet connection","Try a simpler search term","Browse without filters"],telemetryEvent:"search_empty_error"};default:return ee("pre-search",s)}}const je=[{code:"cannabis-raw",name:"Cannabis",count:"180+"},{code:"hemp-industrial",name:"Hemp",count:"120+"},{code:"wellness-lifestyle",name:"CBD & Wellness",count:"95+"},{code:"cannabis-extracts",name:"Extracts",count:"65+"}];async function we(l){const s=new URLSearchParams(l).toString(),r=await pe(`/api/listings/browse?${s}`,{method:"GET"});if(!r.ok)throw new Error("Browse failed");return r.json()}function ze(){var J;const[l,s]=u.useState(1),[r,i]=u.useState(""),[c,w]=u.useState(""),[g,N]=u.useState(""),[m,a]=u.useState(""),[o,b]=u.useState(!1),{toast:F}=he(),C=ue("enableEmptyStateV2"),{logShadowEvent:E}=xe(),R=20,{data:y,isFetching:p,isError:P,refetch:A}=G({queryKey:["browse",{query:r,page:l,limit:R,category:c,subtype:g,region:m,verifiedOnly:o}],queryFn:()=>we({query:r,page:l,limit:R,category:c,subtype:g,region:m,verifiedOnly:o}),keepPreviousData:!0}),x=(y==null?void 0:y.total)??0,z=Math.max(1,Math.ceil(x/R));function S(){s(1)}const H=async(d,h)=>{try{await fetch("/api/telemetry/event",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventType:d,metadata:{query:r,category:c,region:m,verifiedOnly:o,hasFilters:!!(c||m||o),...h}})})}catch(se){console.warn("Failed to log telemetry event:",se)}},M=(d,h)=>{i(d),h!=null&&h.category&&w(h.category.join(",")),h!=null&&h.region&&a(h.region),S()},B=()=>{w(""),N(""),a(""),b(!1),S(),F({title:"Filters cleared",description:"All search filters have been removed"})},k=()=>{window.location.href="/create-listing"},D=()=>{F({title:"Feature coming soon",description:"Product alerts will be available in an upcoming update"})},_=()=>{A()},t=d=>{i(d),S()},n=(d,h)=>{switch(d){case"narrow-filters":return{variant:"search-narrow",icon:e.jsx(U,{size:48}),title:"No results found",description:"Try removing some filters or adjusting your search criteria.",actions:[{label:"Clear filters",onClick:h.onClearFilters}],suggestions:[],telemetryEvent:"search_empty_narrow_simple"};case"zero-supply":return{variant:"search-zero",icon:e.jsx(Z,{size:48}),title:"No products found",description:"We don't have products matching your search at the moment.",actions:[{label:"Create listing",onClick:h.onCreateListing,icon:e.jsx(K,{size:16})}],suggestions:[],telemetryEvent:"search_empty_zero_simple"};case"error":return{variant:"search-error",icon:e.jsx($,{size:48}),title:"Something went wrong",description:"Please try again or contact support if the problem persists.",actions:[{label:"Try again",onClick:h.onRetrySearch}],suggestions:[],telemetryEvent:"search_empty_error_simple"};default:return{variant:"search-pre",icon:e.jsx(T,{size:48}),title:"Search our marketplace",description:"Find cannabis, hemp, and CBD products from verified sellers.",actions:[],suggestions:[],telemetryEvent:"search_empty_pre_simple"}}},L=ve({query:r,hasFilters:!!(c||g||m||o),category:c,region:m,verifiedOnly:o,total:x,isError:P,isLoading:p}),f=C?ee(L,{onClearFilters:B,onRetrySearch:_,onCreateListing:k,onSetupAlert:D,onSearchSuggestion:t}):n(L,{onClearFilters:B,onRetrySearch:_,onCreateListing:k});u.useEffect(()=>{var d,h;!p&&x===0&&(H(f.telemetryEvent,{emptyStateType:L,totalFilters:[c,g,m].filter(Boolean).length+(o?1:0)}),E("enableEmptyStateV2","empty_state_shown",{emptyStateType:L,flagEnabled:C,isEnhanced:C,searchContext:{hasQuery:!!r,hasFilters:!!(c||m||o),total:x,isError:P},enhancedFeatures:C?{hasSuggestions:((d=f.suggestions)==null?void 0:d.length)>0,hasActions:((h=f.actions)==null?void 0:h.length)>0,variant:f.variant}:null}))},[x,p,L,c,g,m,o,C,E]);const te=!p&&(x===0||!r&&!c&&!m&&!o),re=!p&&x>0;return e.jsxs("div",{className:"space-y-6 max-w-6xl mx-auto p-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(ye,{onSearch:M,placeholder:"Search cannabis, hemp, CBD products...",isLoading:p})}),(c||g||m||o)&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Active filters:"}),c&&e.jsxs(j,{variant:"secondary",className:"flex items-center gap-1",children:[((J=je.find(d=>d.code===c))==null?void 0:J.name)||c,e.jsx("button",{onClick:()=>{w(""),S()},className:"ml-1 hover:text-destructive","aria-label":"Remove category filter",children:"Ã—"})]}),m&&e.jsxs(j,{variant:"secondary",className:"flex items-center gap-1",children:["ðŸ“ ",m,e.jsx("button",{onClick:()=>{a(""),S()},className:"ml-1 hover:text-destructive","aria-label":"Remove region filter",children:"Ã—"})]}),o&&e.jsxs(j,{variant:"secondary",className:"flex items-center gap-1",children:["Verified only",e.jsx("button",{onClick:()=>{b(!1),S()},className:"ml-1 hover:text-destructive","aria-label":"Remove verified filter",children:"Ã—"})]}),e.jsx(v,{variant:"ghost",size:"sm",onClick:B,className:"text-xs",children:"Clear all"})]}),p&&e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#173c1e]"}),e.jsx("span",{className:"ml-3 text-muted-foreground",children:"Searching products..."})]}),te&&e.jsx(fe,{variant:f.variant,icon:f.icon,title:f.title,description:f.description,actions:f.actions,suggestions:f.suggestions,className:"my-8"}),re&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("h2",{className:"text-lg font-semibold",children:[x," product",x!==1?"s":""," found",r&&e.jsxs("span",{className:"text-muted-foreground",children:[' for "',r,'"']})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:((y==null?void 0:y.items)??[]).map(d=>e.jsx(ge,{item:d},d.id))}),z>1&&e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsx(v,{variant:"outline",disabled:l<=1,onClick:()=>s(d=>d-1),children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",l," of ",z]})}),e.jsx(v,{variant:"outline",disabled:l>=z,onClick:()=>s(d=>d+1),children:"Next"})]})]})]})}export{ze as default};

import{i as O,k as R,l as B,r as T,m as D,ak as P,al as $,n as H,j as e,M as U,B as b,am as V,an as r,ao as o,as as l,aq as c,I as N,ar as d,H as G,J as Q,K as z,N as J,O as k,o as m,a3 as x,a4 as h,b8 as X,p as u,D as W,h as Y,g as F,at as Z,au as _,aw as i,F as w,G as I,b as ee,a5 as se,aT as ae}from"./index-DE3WvtMD.js";import{D as te,b as ne,a as ie,c as re,d as oe,e as le,f as ce}from"./dialog-BEaSUMTJ.js";import{T as de}from"./textarea-DxM8kpuO.js";import{U as me}from"./user-plus-BntX1V6v.js";import{B as xe}from"./building-2-Di7O9HAg.js";import{C as he}from"./circle-check-L_0MTdEX.js";const ue=i.object({sellerEmail:i.string().email("Please enter a valid email address"),commissionType:i.enum(["flat","percent"]),commissionRate:i.number().min(0,"Commission rate must be positive"),description:i.string().optional(),expiresAt:i.string().min(1,"Expiration date is required")});function be(){const C=O(),{user:j}=R(),{toast:S}=B(),[E,g]=T.useState(!1);T.useEffect(()=>{j&&j.role!=="broker"&&C("/dashboard")},[j,C]);const{data:a,isLoading:p}=D({queryKey:["/api/broker/stats"],queryFn:async()=>await(await w("GET","/api/broker/stats")).json()}),{data:f,isLoading:M}=D({queryKey:["/api/broker/mandates"],queryFn:async()=>await(await w("GET","/api/broker/mandates")).json()}),t=P({resolver:$(ue),defaultValues:{sellerEmail:"",commissionType:"percent",commissionRate:5,description:"",expiresAt:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0]}}),v=H({mutationFn:async s=>await(await w("POST","/api/broker/invite-mandate",s)).json(),onSuccess:()=>{S({title:"Invitation sent!",description:"The seller will receive an email with your mandate invitation."}),g(!1),t.reset(),I.invalidateQueries({queryKey:["/api/broker/mandates"]}),I.invalidateQueries({queryKey:["/api/broker/stats"]})},onError:s=>{S({title:"Failed to send invitation",description:s.message,variant:"destructive"})}}),L=s=>{v.mutate(s)},A=s=>{const n={active:{variant:"default",icon:he,color:"text-green-600"},pending:{variant:"secondary",icon:F,color:"text-yellow-600"},expired:{variant:"outline",icon:se,color:"text-red-600"},revoked:{variant:"destructive",icon:ae,color:"text-red-600"}},y=n[s]||n.pending,q=y.icon;return e.jsxs(ee,{variant:y.variant,className:y.color,children:[e.jsx(q,{className:"w-3 h-3 mr-1"}),s.charAt(0).toUpperCase()+s.slice(1)]})},K=[{header:"Seller Organization",accessorKey:"sellerOrgName"},{header:"Status",accessorKey:"status",cell:({row:s})=>A(s.original.status)},{header:"Commission",accessorKey:"commissionRate",cell:({row:s})=>{const n=s.original;return n.commissionType==="percent"?`${n.commissionRate}%`:`$${n.commissionRate}`}},{header:"Listings",accessorKey:"totalListings",cell:({row:s})=>s.original.totalListings||0},{header:"Total Earned",accessorKey:"totalCommissions",cell:({row:s})=>`$${(s.original.totalCommissions||0).toFixed(2)}`},{header:"Expires",accessorKey:"expiresAt",cell:({row:s})=>new Date(s.original.expiresAt).toLocaleDateString()}];return j?e.jsx(U,{children:e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-[#173c1e]",children:"Broker Dashboard"}),e.jsx("p",{className:"text-[#173c1e]/70",children:"Manage your seller mandates and track commission earnings"})]}),e.jsxs(te,{open:E,onOpenChange:g,children:[e.jsx(ne,{asChild:!0,children:e.jsxs(b,{className:"bg-[#173c1e] text-white hover:bg-[#173c1e]/90",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Invite Seller"]})}),e.jsxs(ie,{className:"sm:max-w-[500px]",children:[e.jsxs(re,{children:[e.jsx(oe,{children:"Invite Seller to Mandate"}),e.jsx(le,{children:"Send a mandate invitation to a seller. They can accept, reject, or negotiate terms."})]}),e.jsx(V,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(L),className:"space-y-4",children:[e.jsx(r,{control:t.control,name:"sellerEmail",render:({field:s})=>e.jsxs(o,{children:[e.jsx(l,{children:"Seller Email"}),e.jsx(c,{children:e.jsx(N,{placeholder:"seller@example.com",...s})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(r,{control:t.control,name:"commissionType",render:({field:s})=>e.jsxs(o,{children:[e.jsx(l,{children:"Commission Type"}),e.jsxs(G,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(c,{children:e.jsx(Q,{children:e.jsx(z,{placeholder:"Select type"})})}),e.jsxs(J,{children:[e.jsx(k,{value:"percent",children:"Percentage"}),e.jsx(k,{value:"flat",children:"Flat Rate"})]})]}),e.jsx(d,{})]})}),e.jsx(r,{control:t.control,name:"commissionRate",render:({field:s})=>e.jsxs(o,{children:[e.jsx(l,{children:t.watch("commissionType")==="percent"?"Rate (%)":"Amount ($)"}),e.jsx(c,{children:e.jsx(N,{type:"number",step:"0.01",...s,onChange:n=>s.onChange(parseFloat(n.target.value))})}),e.jsx(d,{})]})})]}),e.jsx(r,{control:t.control,name:"expiresAt",render:({field:s})=>e.jsxs(o,{children:[e.jsx(l,{children:"Mandate Expires"}),e.jsx(c,{children:e.jsx(N,{type:"date",...s})}),e.jsx(d,{})]})}),e.jsx(r,{control:t.control,name:"description",render:({field:s})=>e.jsxs(o,{children:[e.jsx(l,{children:"Description (Optional)"}),e.jsx(c,{children:e.jsx(de,{placeholder:"Add any additional terms or notes...",...s})}),e.jsx(d,{})]})}),e.jsxs(ce,{children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(b,{type:"submit",disabled:v.isPending,className:"bg-[#173c1e] text-white hover:bg-[#173c1e]/90",children:v.isPending?"Sending...":"Send Invitation"})]})]})})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[e.jsxs(m,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Active Mandates"}),e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold text-[#173c1e]",children:p?"...":(a==null?void 0:a.activeMandates)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Current partnerships"})]})]}),e.jsxs(m,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Total Earned"}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsxs("div",{className:"text-2xl font-bold text-[#173c1e]",children:["$",p?"...":((a==null?void 0:a.totalCommissions)||0).toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Commission earnings"})]})]}),e.jsxs(m,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Listings Managed"}),e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold text-[#173c1e]",children:p?"...":(a==null?void 0:a.totalListings)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"On behalf of sellers"})]})]}),e.jsxs(m,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Pending Invites"}),e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold text-[#173c1e]",children:p?"...":(a==null?void 0:a.pendingInvitations)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Awaiting response"})]})]})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center text-[#173c1e]",children:[e.jsx(xe,{className:"w-5 h-5 mr-2"}),"My Mandates"]}),e.jsx(Z,{children:"Manage your seller relationships and track performance"})]}),e.jsx(u,{children:M?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading mandates..."})}):f&&f.length>0?e.jsx(_,{columns:K,data:f}):e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"No mandates found. Start by inviting sellers to work with you."})})})]})]})}):null}export{be as default};

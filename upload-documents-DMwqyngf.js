import{i as D,l as U,r as k,j as e,M as q,B as l,o as B,a3 as S,a2 as E,a4 as A,at as O,p as R,a1 as m,G as $,b,aT as F}from"./index-DE3WvtMD.js";import{A as P}from"./arrow-left-CBn638CS.js";import{U as x}from"./upload-YqRjUqR5.js";const N=[{type:"license",title:"Cannabis License",description:"Your official cannabis cultivation/distribution license",required:!0},{type:"coa",title:"Certificate of Analysis (COA)",description:"Recent COA for your cannabis products",required:!0},{type:"insurance",title:"Insurance Certificate",description:"Business insurance documentation",required:!1},{type:"registration",title:"Business Registration",description:"Company registration certificate",required:!1}];function z(){const h=D(),{toast:d}=U(),[f,p]=k.useState([]),g=async(t,a)=>{try{const n={type:t,name:a.name,status:"uploading"};p(c=>[...c.filter(u=>u.type!==t),n]);const s={documentType:t,fileName:a.name,originalName:a.name,fileSize:a.size,mimeType:a.type,objectPath:`uploads/documents/${Date.now()}-${a.name}`,description:`Uploaded ${t} document`};console.log("Sending document payload:",s);const i=await fetch("/api/documents",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(!i.ok){const c=await i.json();throw console.error("Document upload error:",c),new Error(`Failed to save document: ${JSON.stringify(c)}`)}const o=await i.json(),r={type:t,name:a.name,status:"uploaded"};p(c=>[...c.filter(u=>u.type!==t),r]),$.invalidateQueries({queryKey:["/api/documents"]}),d({title:"Document uploaded!",description:`${a.name} has been uploaded successfully. It will be reviewed within 24-48 hours.`})}catch(n){console.error("Upload error:",n),p(s=>s.filter(i=>i.type!==t)),d({title:"Upload failed",description:`Failed to upload ${a.name}. Please try again.`,variant:"destructive"})}},j=()=>{h("/onboarding/seller")},w=()=>{d({title:"Documents submitted!",description:"Your documents have been submitted for review. You'll be notified once they're verified."}),h("/onboarding/seller")},y=t=>{const a=f.find(n=>n.type===t);return(a==null?void 0:a.status)||null},C=t=>{if(!t)return e.jsx(b,{variant:"outline",children:"Not uploaded"});const n={uploading:{variant:"secondary",icon:x,color:"text-gray-600",text:"Uploading..."},uploaded:{variant:"secondary",icon:m,color:"text-blue-600",text:"Uploaded"},pending:{variant:"secondary",icon:F,color:"text-yellow-600",text:"Under Review"},verified:{variant:"default",icon:m,color:"text-green-600",text:"Verified"}}[t],s=n.icon;return e.jsxs(b,{variant:n.variant,className:n.color,children:[e.jsx(s,{className:"w-3 h-3 mr-1"}),n.text]})},v=N.filter(t=>t.required).every(t=>y(t.type));return e.jsx(q,{children:e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs(l,{variant:"ghost",onClick:j,className:"mr-4 text-[#173c1e]/70",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Back to Onboarding"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-[#173c1e]",children:"Upload Documents"}),e.jsx("p",{className:"text-[#173c1e]/70",children:"Upload your business documents for verification"})]})]}),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[N.map(t=>{const a=y(t.type),n=f.find(s=>s.type===t.type);return e.jsxs(B,{children:[e.jsx(S,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(E,{className:"w-5 h-5 text-[#173c1e]"}),e.jsxs("div",{children:[e.jsxs(A,{className:"text-[#173c1e]",children:[t.title,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(O,{children:t.description})]})]}),C(a)]})}),e.jsx(R,{children:n?e.jsxs("div",{className:"flex items-center justify-between p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-700",children:n.name})]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{const s=window.document.createElement("input");s.type="file",s.accept=".pdf,.jpg,.jpeg,.png",s.onchange=i=>{var r;const o=(r=i.target.files)==null?void 0:r[0];o&&g(t.type,o)},s.click()},className:"border-green-600 text-green-600 hover:bg-green-50",children:"Replace"})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx(x,{className:"w-8 h-8 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Drag and drop your file here, or click to select"}),e.jsxs(l,{variant:"outline",onClick:()=>{const s=window.document.createElement("input");s.type="file",s.accept=".pdf,.jpg,.jpeg,.png",s.onchange=i=>{var r;const o=(r=i.target.files)==null?void 0:r[0];o&&g(t.type,o)},s.click()},className:"border-[#173c1e]/20","data-testid":`button-upload-${t.type}`,children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"Select File"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Supported formats: PDF, JPG, PNG (Max 10MB)"})]})})]},t.type)}),e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t",children:[e.jsx("div",{className:"text-sm text-[#173c1e]/70",children:v?e.jsx("span",{className:"text-green-600 font-medium",children:"âœ“ All required documents uploaded"}):e.jsx("span",{children:"Upload required documents (*) to continue"})}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(l,{variant:"outline",onClick:j,className:"border-[#173c1e]/20",children:"Back"}),e.jsx(l,{onClick:w,disabled:!v,className:"bg-[#173c1e] text-white hover:bg-[#173c1e]/90","data-testid":"button-continue",children:"Continue"})]})]})]})]})})}export{z as default};
